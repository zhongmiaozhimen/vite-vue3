import{r as p,A,k as y,o as d,h as Y,_ as Z,c as v,l as t,e as T,m as n,F as se,d as ye,B as ke,C as ge,g as K,a as k,D as Q,t as U,v as he,E as be,i as Re,n as ne,G as ue,p as re,q as de}from"./index-dc8e17fe.js";const X={__name:"cell-input",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(r,{emit:P}){const g=r,f=p(null);function _(){f.value.focus()}function V(){const h=g.modelValue.trim();P("update:model-value",h)}return A(()=>{g.autofocus&&_()}),(h,c)=>{const $=y("el-input");return d(),Y($,{ref_key:"inputRef",ref:f,"model-value":r.modelValue,placeholder:"请输入","onUpdate:modelValue":c[0]||(c[0]=x=>h.$emit("update:model-value",x)),onBlur:V},null,8,["model-value"])}}};const Ve={__name:"cell-date",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(r,{expose:P}){const g=r,f=p(null);let _=null,V=null;const h=`date-picker-wrap-${Date.now()}`,c=`date-prper-${Date.now()}`;function $(){f.value.focus()}function x(){return _}function b(){return V}return A(()=>{g.autofocus&&$(),_=document.querySelector(`.${h}`),V=document.querySelector(`.${c}`)}),P({getDatePickerWrapEl:x,getPoppertEl:b}),(q,I)=>{const M=y("el-date-picker");return d(),v("div",{class:T(["date-picker-wrap",h])},[t(M,{ref_key:"dateRef",ref:f,"model-value":r.modelValue,type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期","popper-class":c,"onUpdate:modelValue":I[0]||(I[0]=s=>q.$emit("update:model-value",s))},null,8,["model-value"])],2)}}},Ce=Z(Ve,[["__scopeId","data-v-91adbd17"]]),ie={__name:"cell-select",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(r,{expose:P}){const g=r,f=p(null);function _(){f.value.toggleMenu()}function V(){return f.value.popperPaneRef}return A(()=>{g.autofocus&&_()}),P({getPoppertEl:V}),(h,c)=>{const $=y("el-option"),x=y("el-select");return d(),Y(x,{ref_key:"selectRef",ref:f,"model-value":r.modelValue,placeholder:"请选择",clearable:"",filterable:"","onUpdate:modelValue":c[0]||(c[0]=b=>h.$emit("update:model-value",b))},{default:n(()=>[(d(!0),v(se,null,ye(r.options,b=>(d(),Y($,{key:b,label:b,value:b},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}},xe={__name:"textarea-popover",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0},virtualRef:{type:HTMLElement,default:void 0}},emits:["update:model-value"],setup(r,{expose:P,emit:g}){const f=r,_=p(null),V=p(null);function h(){V.value.focus()}function c(){const x=f.modelValue.trim();g("update:model-value",x)}function $(){return _.value.popperRef.contentRef}return A(()=>{f.autofocus&&h()}),P({getPopoverEl:$}),(x,b)=>{const q=y("el-input"),I=y("el-popover");return d(),Y(I,{ref_key:"popoverRef",ref:_,visible:"","virtual-ref":r.virtualRef,trigger:"click","virtual-triggering":"",placement:"bottom-start",width:200},{default:n(()=>[t(q,{ref_key:"inputRef",ref:V,"model-value":r.modelValue,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入","onUpdate:modelValue":b[0]||(b[0]=M=>x.$emit("update:model-value",M)),onBlur:c},null,8,["model-value"])]),_:1},8,["virtual-ref"])}}};const B=r=>(re("data-v-e23442a1"),r=r(),de(),r),Ee={class:"mg-top-10"},Se=B(()=>k("i",{class:"required"},"*",-1)),Be=B(()=>k("span",{class:"label"},"日期",-1)),Pe=B(()=>k("i",{class:"required"},"*",-1)),$e=B(()=>k("span",{class:"label"},"名字",-1)),we=B(()=>k("i",{class:"required"},"*",-1)),ze=B(()=>k("span",{class:"label"},"省份",-1)),De=B(()=>k("i",{class:"required"},"*",-1)),Ue=B(()=>k("span",{class:"label"},"城市",-1)),Ie=B(()=>k("i",{class:"required"},"*",-1)),Me=B(()=>k("span",{class:"label"},"地址",-1)),qe=B(()=>k("span",{class:"label"},"邮编",-1)),Te={key:1,class:"no-editor tooltip"},Le=B(()=>k("span",{class:"label"},"备注",-1)),Ne={key:1,class:"no-editor tooltip"},We={class:"tooltip-wrap"},Ye={__name:"index",setup(r){const P=[{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""}],g=p(null),f=p(!1),_=p(null),V=p(""),h=p(!0),c=p([{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""}]),$=[{province:"黑龙江",citys:["哈尔滨","齐齐哈尔","鸡西","鹤岗"]},{province:"吉林",citys:["长春","通化","白山","四平"]},{province:"辽宁",citys:["辽阳","大连","鞍山","抚顺"]}];let x=[],b=[];const q=["date","name","province","city","address","zip","remark"],I=["date","name","province","city","address"],M=p([]);c.value.forEach(a=>{te(a.id)});const s=p(""),w=p(""),m=p("");let C=null,z=[];const D=p(null),F=p(null),O=p(null);let H=!0;const ee=p(null),L=p(null);function te(a){let e={id:a};q.forEach(l=>{e[l]=""}),M.value.push(e)}function N(a,e){const l=M.value.find(u=>u.id===a);if(l)return l[e]}function G(a,e,l){const u=M.value.find(i=>i.id===a);u&&(u[e]=l)}function ce(a,e,l,u){var E;const i=e.property;if(q.includes(i)){if(i==="remark"&&L.value){j();return}if(!((E=z[0])!=null&&E.contains(u.target))){if(j(),i==="province")x=$.map(R=>R.province);else if(i==="city")if(a.province){const{citys:R}=$.find(W=>W.province===a.province);b=R}else b=[];else i==="remark"&&(L.value=l);h.value=!1,C=a,w.value=a.id,m.value=i,s.value=a[i],H=!0,ne(()=>{z=[D.value],i==="date"?z.push(F.value.getPoppertEl()):i==="province"||i==="city"?z.push(O.value.getPoppertEl()):i==="remark"&&z.push(ee.value.getPopoverEl())})}}}function j(){z.length!==0&&(I.includes(m.value)&&(s.value?C[m.value]!==s.value&&G(C.id,m.value,"success"):G(C.id,m.value,"error")),C[m.value]=s.value,C=null,w.value="",m.value="",s.value="",z=[],H=!0,L.value=null)}function le(){if(!s.value){C.city="";return}const a=C.city,{citys:e}=$.find(l=>l.province===s.value);e.includes(a)||(C.city="")}function pe(){m.value==="province"&&le(),j(),c.value.push({id:`${Date.now()}-${c.value.length+1}`,date:"",name:"",province:"",city:"",address:"",zip:"",remark:""}),C=c.value[c.value.length-1],w.value=C.id,m.value="date",s.value=C.date,H=!1,te(C.id),ne(()=>{const a=g.value.layout.table.refs.tableBody;g.value.setScrollTop(a.clientHeight),g.value.setScrollLeft(0),z=[D.value,F.value.getPoppertEl()]})}function fe(a){const e=c.value.findIndex(l=>l.id===a);e>=0&&c.value.splice(e,1)}function ae(a){let e=!1;if(c.value.forEach(l=>{for(const u in l)I.includes(u)&&!l[u]&&(e=!0,G(l.id,u,"error"))}),e){ue.alert("必填项未填写","",{confirmButtonText:"确认",type:"error",callback:()=>{}});return}new Promise(l=>{setTimeout(()=>{l()},500)}).then(()=>{a&&a()})}function ve(){let a=!1;if(c.value.length!==P.length)return a=!0,a;let e=null;return c.value.some(l=>{if(e=P.find(u=>u.id===l.id),e){for(const u in e)if(e[u]!==l[u])return a=!0,!0}else return a=!0,!0}),a}function oe(a){z.length===0||z.some(l=>l==null?void 0:l.contains(a.target))||(m.value==="province"&&le(),j())}function me(a,e,l){const u=l.querySelector(".tooltip");if(!u)return;const i=document.createRange();i.setStart(u,0),i.setEnd(u,u.childNodes.length);const E=i.getBoundingClientRect().width,R=window.getComputedStyle(u),W=parseInt(R.getPropertyValue("padding-left"))+parseInt(R.getPropertyValue("padding-right")),J=u.getBoundingClientRect().width;E+W-J>.02&&(h.value=!0,_.value=u,f.value=!0,V.value=u.innerText)}function _e(){f.value=!1,V.value="",_.value=null}return A(()=>{document.addEventListener("mouseup",oe)}),ke(()=>{document.removeEventListener("mouseup",oe)}),ge((a,e,l)=>{if(ve()){ue.confirm("是否保存数据","",{confirmButtonText:"保存",cancelButtonText:"取消",type:"info",distinguishCancelAndClose:!0,callback:u=>{u==="confirm"?ae(()=>{l()}):u==="cancel"&&l()}});return}l()}),(a,e)=>{const l=y("el-button"),u=y("el-row"),i=y("el-table-column"),E=y("EditPen"),R=y("el-icon"),W=y("el-table"),J=y("el-tooltip");return d(),v("div",null,[t(u,{justify:"end"},{default:n(()=>[t(l,{type:"primary",plain:"",onClick:pe},{default:n(()=>[K("新增")]),_:1})]),_:1}),k("div",Ee,[t(W,{ref_key:"tableRef",ref:g,data:c.value,border:"",stripe:"","max-height":400,onCellClick:ce,onCellMouseEnter:me,onCellMouseLeave:_e},{default:n(()=>[t(i,{type:"index",fixed:"",label:"序号",width:"70"}),t(i,{prop:"date",label:"日期","min-width":"140","class-name":"editor-column"},{header:n(()=>[Se,Be,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="date"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"editor"},[t(Ce,{ref_key:"cellDateRef",ref:F,modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=S=>s.value=S),autofocus:Q(H)},null,8,["modelValue","autofocus"])],512)):(d(),v("div",{key:1,class:T(["no-editor","tooltip",N(o.id,"date")])},U(o.date),3))]),_:1}),t(i,{prop:"name",label:"名字","min-width":"120","class-name":"editor-column"},{header:n(()=>[Pe,$e,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="name"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"editor"},[t(X,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=S=>s.value=S)},null,8,["modelValue"])],512)):(d(),v("div",{key:1,class:T(["no-editor","tooltip",N(o.id,"name")])},U(o.name),3))]),_:1}),t(i,{prop:"province",label:"省份","min-width":"120","class-name":"editor-column"},{header:n(()=>[we,ze,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="province"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"editor"},[t(ie,{ref_key:"cellSelectRef",ref:O,modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=S=>s.value=S),options:Q(x)},null,8,["modelValue","options"])],512)):(d(),v("div",{key:1,class:T(["no-editor","tooltip",N(o.id,"province")])},U(o.province),3))]),_:1}),t(i,{prop:"city",label:"城市","min-width":"120","class-name":"editor-column"},{header:n(()=>[De,Ue,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="city"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"editor"},[t(ie,{ref_key:"cellSelectRef",ref:O,modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=S=>s.value=S),options:Q(b)},null,8,["modelValue","options"])],512)):(d(),v("div",{key:1,class:T(["no-editor","tooltip",N(o.id,"city")])},U(o.city),3))]),_:1}),t(i,{prop:"address",label:"地址","min-width":"170","class-name":"editor-column"},{header:n(()=>[Ie,Me,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="address"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"editor"},[t(X,{modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=S=>s.value=S)},null,8,["modelValue"])],512)):(d(),v("div",{key:1,class:T(["no-editor","tooltip",N(o.id,"address")])},U(o.address),3))]),_:1}),t(i,{prop:"zip",label:"邮编","min-width":"120","class-name":"editor-column"},{header:n(()=>[qe,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="zip"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"editor"},[t(X,{modelValue:s.value,"onUpdate:modelValue":e[5]||(e[5]=S=>s.value=S)},null,8,["modelValue"])],512)):(d(),v("div",Te,U(o.zip),1))]),_:1}),t(i,{prop:"remark",label:"备注","min-width":"180","class-name":"editor-column"},{header:n(()=>[Le,t(R,null,{default:n(()=>[t(E)]),_:1})]),default:n(({row:o})=>[w.value===o.id&&m.value==="remark"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:D,class:"popover-edit"},U(o.remark),513)):(d(),v("div",Ne,U(o.remark),1))]),_:1}),t(i,{label:"操作","min-width":"70",fixed:"right"},{default:n(({row:o})=>[t(u,null,{default:n(()=>[t(l,{link:"",type:"primary",onClick:S=>fe(o.id)},{default:n(()=>[K("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),he(k("div",We,[t(J,{visible:f.value,"onUpdate:visible":e[6]||(e[6]=o=>f.value=o),"virtual-ref":_.value,"virtual-triggering":"",content:V.value,placement:"top",teleported:!1},null,8,["visible","virtual-ref","content"])],512),[[be,h.value]]),L.value?(d(),Y(xe,{key:0,ref_key:"textareaPopoverRef",ref:ee,modelValue:s.value,"onUpdate:modelValue":e[7]||(e[7]=o=>s.value=o),"virtual-ref":L.value},null,8,["modelValue","virtual-ref"])):Re("",!0)]),t(u,{justify:"center",class:"mg-top-20"},{default:n(()=>[t(l,{type:"primary",onClick:e[8]||(e[8]=o=>ae())},{default:n(()=>[K("保存")]),_:1})]),_:1})])}}},Ae=Z(Ye,[["__scopeId","data-v-e23442a1"]]);const He=r=>(re("data-v-81755b78"),r=r(),de(),r),je=He(()=>k("div",{class:"title"},"表格编辑",-1)),Fe={__name:"index",setup(r){return(P,g)=>{const f=y("el-tab-pane"),_=y("el-tabs");return d(),v(se,null,[je,t(_,{"model-value":"1"},{default:n(()=>[t(f,{label:"单元格编辑",name:"1"},{default:n(()=>[t(Ae)]),_:1})]),_:1})],64)}}},Ge=Z(Fe,[["__scopeId","data-v-81755b78"]]);export{Ge as default};
