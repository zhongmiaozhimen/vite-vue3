import{_ as O,r as g,n as j,w as q,o as I,c as M,a as T,b as F,F as N,d as te,e as le,f as ae,g as L,t as W,h as oe,T as ne,i as ie,j as G,k as w,l as n,m as f,p as ue,q as re}from"./index-539f508b.js";const se={class:"virtual-list"},de={__name:"virtual-list",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},cache:{type:Number,default:2},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0},showOverflowTooltip:{type:Boolean,default:!1}},setup(h){const e=h;let r=z(),i=r.length;const _=g(e.height?null:e.maxHeight);let p=0,H=0,m=0;const a=g([]);let t=0,s=0;const c=g(0),x=g(0),V=g(null),o=g(null);let $=[],E=!1;const v=g(null);Q();function z(){return e.data.map((l,u)=>({id:`${Date.now()}-${u}`,data:l}))}function k(){a.value=r,c.value=0,x.value=0}function K(){if(!e.height&&!e.maxHeight)return;let l=0;return e.fixed?e.height?l=Math.ceil(e.height/p):l=Math.ceil(e.maxHeight/p):e.height?l=Math.ceil(e.height/e.minItemHeight):l=Math.ceil(e.maxHeight/e.minItemHeight),l}function P(){const l=o.value.children,u=[];for(let d=0;d<l.length;d++)u.push(l[d].getBoundingClientRect().height);for(let d=u.length;d<r.length;d++)u.push(e.minItemHeight);return u}function Q(){if(i<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){k();return}if(e.fixed){a.value=r.slice(0,1),j(()=>{p=o.value.children[0].clientHeight,S()});return}S()}function S(){if(H=K(),m=e.cache+e.buffer*2,m<2&&(m=2),H+m>=i){k();return}const l=H+m;t=0,s=l-1,c.value=0,e.fixed?x.value=(i-l)*p:x.value=(i-l)*e.minItemHeight,a.value=r.slice(t,s+1),e.fixed||j(()=>{$=P()})}function X(l){let u=0;if(e.fixed)u=Math.floor(l/p);else{let C=0;for(let y=0;y<$.length;y++){if(C+=$[y],l===C){u=y+1;break}if(l<C){u=y;break}}}const d=u-t;if(s+1-u-H>e.buffer&&d>e.buffer)return;let B=u-Math.floor(m/2);const A=i-a.value.length;if(B<0?B=0:B>A&&(B=A),B===t)return;t=B,s=t+a.value.length-1;const D=i-1;if(s>D&&(s=D),a.value=r.slice(t,s+1),e.fixed)c.value=t*p,x.value=(i-s-1)*p;else{let C=0;for(let b=0;b<t;b++)C+=$[b];c.value=C;let y=0;for(let b=s+1;b<i;b++)y+=$[b];x.value=y,j(()=>{const b=o.value.children,R=[];for(let U=0;U<b.length;U++)R.push(b[U].getBoundingClientRect().height);$.splice(t,R.length,...R)})}}q(()=>e.data,()=>{if(V.value&&(V.value.scrollTop=0),r=z(),i=r.length,i<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){k();return}S()}),q([()=>e.height,()=>e.maxHeight],()=>{if(i<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){k();return}_.value=e.height?null:e.maxHeight,S()});function Y(l){e.showOverflowTooltip&&(v.value=null),!(i<=2||!e.height&&!e.maxHeight||a.value.length>=i||!e.fixed&&!e.minItemHeight)&&(E||(E=!0,requestAnimationFrame(()=>{E=!1}),X(l.target.scrollTop)))}function Z(l){if(!(!e.showOverflowTooltip||l.target===l.currentTarget||v.value&&(v.value.contains(l.fromElement)||!v.value.contains(l.target)))&&(v.value=l.target,l.target.parentElement!==l.currentTarget)){const u=l.currentTarget.children;for(let d=0;d<u.length;d++)if(u[d].contains(l.target)){v.value=u[d];break}}}function ee(l){!e.showOverflowTooltip||v.value&&(!v.value.contains(l.target)||v.value.contains(l.toElement))||(v.value=null)}return(l,u)=>(I(),M("div",se,[T("div",{ref_key:"listWrapRef",ref:V,class:"list-wrap",style:F({height:h.height?h.height+"px":"","max-height":_.value?_.value+"px":""}),onScroll:Y},[T("ul",{ref_key:"listRef",ref:o,style:F({"padding-top":c.value+"px","padding-bottom":x.value+"px"}),onMouseover:Z,onMouseout:ee},[(I(!0),M(N,null,te(a.value,d=>(I(),M("li",{key:d.id,class:le(["list-item",{tooltip:e.showOverflowTooltip}]),style:F({"white-space":h.fixed?"nowrap":"normal","word-break":h.fixed?"normal":"break-all",overflow:h.fixed?"hidden":"visible"})},[ae(l.$slots,"default",{items:d.data},()=>[L(W(d),1)],!0)],6))),128))],36)],36),e.showOverflowTooltip?(I(),oe(ne,{key:0,"mouseenter-el":v.value,enterable:!1,"teleport-to-body":!1},null,8,["mouseenter-el"])):ie("",!0)]))}},J=O(de,[["__scopeId","data-v-5eebc4a0"]]);const fe={class:"wrap"},ce=500,me={__name:"fixed-virtual-list",setup(h){const e=G({total:1e3,buffer:0,cache:2}),r=g([]),i=g(0),_=g(2);p();function p(){r.value=[];for(let a=1;a<=e.total;a++)r.value.push({msg:`${a} --- ${H()}`});i.value=e.buffer,_.value=e.cache}function H(){const a=["aaa"," bbbb"," cccccccccc"," ddddddddddddddddddddddddddddd"," eeeeeeeeeee"," ff"," gggg"," hhhhhh"," ii"," j"," k"],t=Math.ceil(Math.random()*10);return a.slice(0,t).join("")}function m(a){e[a]!==""&&typeof e[a]=="string"&&(e[a]=e[a].replace(/[^0-9]/g,"").replace(/^0+(?=\d)/,""),e[a]=Number(e[a]))}return(a,t)=>{const s=w("el-input"),c=w("el-form-item"),x=w("el-button"),V=w("el-form");return I(),M("div",null,[n(V,{inline:""},{default:f(()=>[n(c,{label:"列表总数"},{default:f(()=>[n(s,{modelValue:e.total,"onUpdate:modelValue":t[0]||(t[0]=o=>e.total=o),modelModifiers:{number:!0},placeholder:"请输入列表总数",maxlength:"6",onBlur:t[1]||(t[1]=o=>m("total"))},null,8,["modelValue"])]),_:1}),n(c,{label:"缓冲量"},{default:f(()=>[n(s,{modelValue:e.buffer,"onUpdate:modelValue":t[2]||(t[2]=o=>e.buffer=o),modelModifiers:{number:!0},placeholder:"请输入滚动时的缓冲量",maxlength:"5",onBlur:t[3]||(t[3]=o=>m("buffer"))},null,8,["modelValue"])]),_:1}),n(c,{label:"预先多加载的列表数量"},{default:f(()=>[n(s,{modelValue:e.cache,"onUpdate:modelValue":t[4]||(t[4]=o=>e.cache=o),modelModifiers:{number:!0},placeholder:"请输入预先多加载的列表数量",maxlength:"5",onBlur:t[5]||(t[5]=o=>m("cache"))},null,8,["modelValue"])]),_:1}),n(c,null,{default:f(()=>[n(x,{type:"primary",onClick:p},{default:f(()=>[L("更新列表")]),_:1})]),_:1})]),_:1}),T("div",fe,[n(J,{data:r.value,"max-height":ce,buffer:i.value,cache:_.value,"show-overflow-tooltip":""},{default:f(({items:o})=>[L(W(o.msg),1)]),_:1},8,["data","buffer","cache"])])])}}},he=O(me,[["__scopeId","data-v-5ac53327"]]);const pe={class:"wrap"},ge=500,_e={__name:"dynamic-virtual-list",setup(h){const e=G({total:1e3,buffer:0,cache:2}),r=g([]),i=g(0),_=g(2);p();function p(){r.value=[];for(let a=1;a<=e.total;a++)r.value.push({msg:`${a} --- ${H()}`});i.value=e.buffer,_.value=e.cache}function H(){const a=["道可道也，非恒道也。","名可名也，非恒名也。","无名万物之始也，有名万物之母也。","故：恒无欲也，以观其眇；","恒有欲也，以观其徼。","两者同出，异名同谓。玄之又玄，众妙之门。","天下皆知美之为美，恶矣，皆知善之为善，斯不善矣。","有无之相生也，难易之相成也，长短之相形也，高下之相盈也，音声之相和也，先后之相随也。","是以圣人居无为之事，行不言之教。","万物作而弗始也，为而弗恃也，成功而弗居也，夫唯弗居，是以弗去。"],t=Math.ceil(Math.random()*10);return a.slice(0,t).join("")}function m(a){typeof e[a]=="string"&&(e[a]=e[a].replace(/[^0-9]/g,"").replace(/^0+(?=\d)/,""),e[a]=Number(e[a]))}return(a,t)=>{const s=w("el-input"),c=w("el-form-item"),x=w("el-button"),V=w("el-form");return I(),M("div",null,[n(V,{inline:""},{default:f(()=>[n(c,{label:"列表总数"},{default:f(()=>[n(s,{modelValue:e.total,"onUpdate:modelValue":t[0]||(t[0]=o=>e.total=o),modelModifiers:{number:!0},placeholder:"请输入列表总数",maxlength:"6",onBlur:t[1]||(t[1]=o=>m("total"))},null,8,["modelValue"])]),_:1}),n(c,{label:"缓冲量"},{default:f(()=>[n(s,{modelValue:e.buffer,"onUpdate:modelValue":t[2]||(t[2]=o=>e.buffer=o),placeholder:"请输入滚动时的缓冲量",maxlength:"5",onBlur:t[3]||(t[3]=o=>m("buffer"))},null,8,["modelValue"])]),_:1}),n(c,{label:"预先多加载的列表数量"},{default:f(()=>[n(s,{modelValue:e.cache,"onUpdate:modelValue":t[4]||(t[4]=o=>e.cache=o),modelModifiers:{number:!0},placeholder:"请输入预先多加载的列表数量",maxlength:"5",onBlur:t[5]||(t[5]=o=>m("cache"))},null,8,["modelValue"])]),_:1}),n(c,null,{default:f(()=>[n(x,{type:"primary",onClick:p},{default:f(()=>[L("更新列表")]),_:1})]),_:1})]),_:1}),T("div",pe,[n(J,{data:r.value,"max-height":ge,buffer:i.value,cache:_.value,fixed:!1},{default:f(({items:o})=>[L(W(o.msg),1)]),_:1},8,["data","buffer","cache"])])])}}},ve=O(_e,[["__scopeId","data-v-5a3f56ca"]]);const xe=h=>(ue("data-v-42faf1d4"),h=h(),re(),h),be=xe(()=>T("div",{class:"title"},"虚拟列表",-1)),we={__name:"index",setup(h){return(e,r)=>{const i=w("el-tab-pane"),_=w("el-tabs");return I(),M(N,null,[be,n(_,{"model-value":"1"},{default:f(()=>[n(i,{label:"定高",name:"1"},{default:f(()=>[n(he)]),_:1}),n(i,{label:"非定高",name:"2",lazy:""},{default:f(()=>[n(ve)]),_:1})]),_:1})],64)}}},Ve=O(we,[["__scopeId","data-v-42faf1d4"]]);export{Ve as default};
