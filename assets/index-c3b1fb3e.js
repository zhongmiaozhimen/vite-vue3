import{r,x as Y,k as g,o as d,h as K,_ as Q,c as _,l as e,e as I,m as t,F as ne,d as fe,y as ve,z as le,g as te,a as m,A as G,t as q,v as _e,B as me,n as oe,p as ue,q as se}from"./index-8bec9ce5.js";const J={__name:"cell-input",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(s,{emit:S}){const $=s,p=r(null);function y(){p.value.focus()}function C(){const b=$.modelValue.trim();S("update:model-value",b)}return Y(()=>{$.autofocus&&y()}),(b,f)=>{const P=g("el-input");return d(),K(P,{ref_key:"inputRef",ref:p,"model-value":s.modelValue,placeholder:"请输入","onUpdate:modelValue":f[0]||(f[0]=w=>b.$emit("update:model-value",w)),onBlur:C},null,8,["model-value"])}}};const ye={__name:"cell-date",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(s,{expose:S}){const $=s,p=r(null);let y=null,C=null;const b=`date-picker-wrap-${Date.now()}`,f=`date-prper-${Date.now()}`;function P(){p.value.focus()}function w(){return y}function V(){return C}return Y(()=>{$.autofocus&&P(),y=document.querySelector(`.${b}`),C=document.querySelector(`.${f}`)}),S({getDatePickerWrapEl:w,getPrpprtEl:V}),(T,W)=>{const M=g("el-date-picker");return d(),_("div",{class:I(["date-picker-wrap",b])},[e(M,{ref_key:"dateRef",ref:p,"model-value":s.modelValue,type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期","popper-class":f,"onUpdate:modelValue":W[0]||(W[0]=a=>T.$emit("update:model-value",a))},null,8,["model-value"])],2)}}},he=Q(ye,[["__scopeId","data-v-394c5674"]]),ae={__name:"cell-select",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(s,{expose:S}){const $=s,p=r(null);function y(){p.value.toggleMenu()}function C(){return p.value.popperPaneRef}return Y(()=>{$.autofocus&&y()}),S({getPrpprtEl:C}),(b,f)=>{const P=g("el-option"),w=g("el-select");return d(),K(w,{ref_key:"selectRef",ref:p,"model-value":s.modelValue,placeholder:"请选择",clearable:"",filterable:"","onUpdate:modelValue":f[0]||(f[0]=V=>b.$emit("update:model-value",V))},{default:t(()=>[(d(!0),_(ne,null,fe(s.options,V=>(d(),K(P,{key:V,label:V,value:V},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}};const x=s=>(ue("data-v-38ea42a9"),s=s(),se(),s),ke={class:"mg-top-10"},ge=x(()=>m("i",{class:"required"},"*",-1)),be=x(()=>m("span",{class:"label"},"日期",-1)),Ce=x(()=>m("i",{class:"required"},"*",-1)),Ve=x(()=>m("span",{class:"label"},"名字",-1)),Re=x(()=>m("i",{class:"required"},"*",-1)),Ee=x(()=>m("span",{class:"label"},"省份",-1)),xe=x(()=>m("i",{class:"required"},"*",-1)),Se=x(()=>m("span",{class:"label"},"城市",-1)),$e=x(()=>m("i",{class:"required"},"*",-1)),Pe=x(()=>m("span",{class:"label"},"地址",-1)),Be=x(()=>m("span",{class:"label"},"邮编",-1)),De={key:1,class:"no-editor tooltip"},we={class:"tooltip-wrap"},ze={__name:"index",setup(s){const S=r(null),$=r(null),p=r(!1),y=r(null),C=r(""),b=r(!0),f=r([{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000"},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000"},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000"},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000"}]),P=[{province:"黑龙江",citys:["哈尔滨","齐齐哈尔","鸡西","鹤岗"]},{province:"吉林",citys:["长春","通化","白山","四平"]},{province:"辽宁",citys:["辽阳","大连","鞍山","抚顺"]}];let w=[],V=[];const T=["date","name","province","city","address","zip"],W=["date","name","province","city","address"],M=r([]);f.value.forEach(o=>{X(o.id)});const a=r(""),B=r(""),v=r("");let h=null,D=[];const z=r(null),j=r(null),A=r(null);let N=!0;function X(o){let l={id:o};T.forEach(i=>{l[i]=""}),M.value.push(l)}function U(o,l){const i=M.value.find(c=>c.id===o);if(i)return i[l]}function F(o,l,i){const c=M.value.find(n=>n.id===o);c&&(c[l]=i)}function ie(o,l,i,c){var R;const n=l.property;if(!(!T.includes(n)||(R=D[0])!=null&&R.contains(c.target))){if(H(),n==="province"&&(w=P.map(k=>k.province)),n==="city")if(o.province){const{citys:k}=P.find(L=>L.province===o.province);V=k}else V=[];b.value=!1,h=o,B.value=o.id,v.value=n,a.value=o[n],N=!0,oe(()=>{D=[z.value],n==="date"?D.push(j.value.getPrpprtEl()):(n==="province"||n==="city")&&D.push(A.value.getPrpprtEl())})}}function H(){D.length!==0&&(W.includes(v.value)&&(a.value?h[v.value]!==a.value&&F(h.id,v.value,"success"):F(h.id,v.value,"error")),h[v.value]=a.value,h=null,B.value="",v.value="",a.value="",D=[],N=!0)}function Z(){if(!a.value){h.city="";return}const o=h.city,{citys:l}=P.find(i=>i.province===a.value);l.includes(o)||(h.city="")}function de(){v.value==="province"&&Z(),H(),f.value.push({id:`${Date.now()}-${f.value.length+1}`,date:"",name:"",province:"",city:"",address:"",zip:""}),h=f.value[f.value.length-1],B.value=h.id,v.value="date",a.value=h.date,N=!1,X(h.id),oe(()=>{const o=S.value.layout.table.refs.tableBody;S.value.setScrollTop(o.clientHeight),D=[z.value,j.value.getPrpprtEl()]})}function ce(){let o=!1;f.value.forEach(l=>{for(const i in l)l[i]||(o=!0,F(l.id,i,"error"))})}function ee(o){D.length===0||D.some(i=>i.contains(o.target))||(v.value==="province"&&Z(),H())}function re(o,l,i){const c=i.querySelector(".tooltip");if(!c)return;const n=document.createRange();n.setStart(c,0),n.setEnd(c,c.childNodes.length);const R=n.getBoundingClientRect().width,k=window.getComputedStyle(c),L=parseInt(k.getPropertyValue("padding-left"))+parseInt(k.getPropertyValue("padding-right")),O=c.getBoundingClientRect().width;R+L-O>.02?(b.value=!0,y.value=c,p.value=!0,C.value=c.innerText):(p.value=!1,C.value="",y.value=null)}function pe(){p.value=!1,C.value="",y.value=null}return Y(()=>{document.addEventListener("mouseup",ee)}),ve(()=>{document.removeEventListener("mouseup",ee)}),(o,l)=>{const i=g("el-button"),c=g("el-row"),n=g("el-table-column"),R=g("EditPen"),k=g("el-icon"),L=g("el-table"),O=g("el-tooltip");return d(),_("div",null,[e(c,{justify:"end"},{default:t(()=>[e(i,{type:"primary",plain:"",onClick:le(de,["stop"])},{default:t(()=>[te("新增")]),_:1},8,["onClick"])]),_:1}),m("div",ke,[e(L,{ref_key:"tableRef",ref:S,data:f.value,border:"",stripe:"","max-height":400,onCellClick:ie,onCellMouseEnter:re,onCellMouseLeave:pe},{default:t(()=>[e(n,{type:"index",fixed:"",label:"序号",width:"80"}),e(n,{prop:"date",label:"日期","min-width":"140","class-name":"editor-column"},{header:t(()=>[ge,be,e(k,null,{default:t(()=>[e(R)]),_:1})]),default:t(({row:u})=>[B.value===u.id&&v.value==="date"?(d(),_("div",{key:0,ref_key:"editCellRef",ref:z,class:"editor"},[e(he,{ref_key:"cellDateRef",ref:j,modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=E=>a.value=E),autofocus:G(N)},null,8,["modelValue","autofocus"])],512)):(d(),_("div",{key:1,class:I(["no-editor","tooltip",U(u.id,"date")])},q(u.date),3))]),_:1}),e(n,{prop:"name",label:"名字","min-width":"120","class-name":"editor-column"},{header:t(()=>[Ce,Ve,e(k,null,{default:t(()=>[e(R)]),_:1})]),default:t(({row:u})=>[B.value===u.id&&v.value==="name"?(d(),_("div",{key:0,ref_key:"editCellRef",ref:z,class:"editor"},[e(J,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=E=>a.value=E)},null,8,["modelValue"])],512)):(d(),_("div",{key:1,class:I(["no-editor","tooltip",U(u.id,"name")])},q(u.name),3))]),_:1}),e(n,{prop:"province",label:"省份","min-width":"120","class-name":"editor-column"},{header:t(()=>[Re,Ee,e(k,null,{default:t(()=>[e(R)]),_:1})]),default:t(({row:u})=>[B.value===u.id&&v.value==="province"?(d(),_("div",{key:0,ref_key:"editCellRef",ref:z,class:"editor"},[e(ae,{ref_key:"cellSelectRef",ref:A,modelValue:a.value,"onUpdate:modelValue":l[2]||(l[2]=E=>a.value=E),options:G(w)},null,8,["modelValue","options"])],512)):(d(),_("div",{key:1,class:I(["no-editor","tooltip",U(u.id,"province")])},q(u.province),3))]),_:1}),e(n,{prop:"city",label:"城市","min-width":"120","class-name":"editor-column"},{header:t(()=>[xe,Se,e(k,null,{default:t(()=>[e(R)]),_:1})]),default:t(({row:u})=>[B.value===u.id&&v.value==="city"?(d(),_("div",{key:0,ref_key:"editCellRef",ref:z,class:"editor"},[e(ae,{ref_key:"cellSelectRef",ref:A,modelValue:a.value,"onUpdate:modelValue":l[3]||(l[3]=E=>a.value=E),options:G(V)},null,8,["modelValue","options"])],512)):(d(),_("div",{key:1,class:I(["no-editor","tooltip",U(u.id,"city")])},q(u.city),3))]),_:1}),e(n,{prop:"address",label:"地址","min-width":"170","class-name":"editor-column"},{header:t(()=>[$e,Pe,e(k,null,{default:t(()=>[e(R)]),_:1})]),default:t(({row:u})=>[B.value===u.id&&v.value==="address"?(d(),_("div",{key:0,ref_key:"editCellRef",ref:z,class:"editor"},[e(J,{modelValue:a.value,"onUpdate:modelValue":l[4]||(l[4]=E=>a.value=E)},null,8,["modelValue"])],512)):(d(),_("div",{key:1,class:I(["no-editor","tooltip",U(u.id,"address")])},q(u.address),3))]),_:1}),e(n,{prop:"zip",label:"邮编","min-width":"120","class-name":"editor-column"},{header:t(()=>[Be,e(k,null,{default:t(()=>[e(R)]),_:1})]),default:t(({row:u})=>[B.value===u.id&&v.value==="zip"?(d(),_("div",{key:0,ref_key:"editCellRef",ref:z,class:"editor"},[e(J,{modelValue:a.value,"onUpdate:modelValue":l[5]||(l[5]=E=>a.value=E)},null,8,["modelValue"])],512)):(d(),_("div",De,q(u.zip),1))]),_:1})]),_:1},8,["data"]),_e(m("div",we,[e(O,{ref_key:"tooltipRef",ref:$,visible:p.value,"virtual-ref":y.value,"virtual-triggering":"",content:C.value,placement:"top",teleported:!1},null,8,["visible","virtual-ref","content"])],512),[[me,b.value]])]),e(c,{justify:"center",class:"mg-top-20"},{default:t(()=>[e(i,{type:"primary",onClick:le(ce,["stop"])},{default:t(()=>[te("保存")]),_:1},8,["onClick"])]),_:1})])}}},qe=Q(ze,[["__scopeId","data-v-38ea42a9"]]);const Ie=s=>(ue("data-v-4f018ecd"),s=s(),se(),s),Me=Ie(()=>m("div",{class:"title"},"表单编辑",-1)),Ue={__name:"index",setup(s){return(S,$)=>{const p=g("el-tab-pane"),y=g("el-tabs");return d(),_(ne,null,[Me,e(y,{"model-value":"1"},{default:t(()=>[e(p,{label:"单元格编辑",name:"1"},{default:t(()=>[e(qe)]),_:1})]),_:1})],64)}}},Te=Q(Ue,[["__scopeId","data-v-4f018ecd"]]);export{Te as default};
