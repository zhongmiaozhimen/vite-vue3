import{a as f,B as Y,b as _,o as d,h as W,_ as X,c as v,d as t,m as M,w as n,F as ie,k as me,C as _e,D as ye,e as J,f as h,E as K,t as I,i as ke,s as ae,G as ne,p as se,g as re}from"./index-106532fd.js";const Q={__name:"cell-input",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(r,{emit:$}){const y=r,p=f(null);function k(){p.value.focus()}function x(){const c=y.modelValue.trim();$("update:model-value",c)}return Y(()=>{y.autofocus&&k()}),(c,g)=>{const z=_("el-input");return d(),W(z,{ref_key:"inputRef",ref:p,"model-value":r.modelValue,placeholder:"请输入","onUpdate:modelValue":g[0]||(g[0]=R=>c.$emit("update:model-value",R)),onBlur:x},null,8,["model-value"])}}};const ge={__name:"cell-date",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(r,{expose:$}){const y=r,p=f(null);let k=null,x=null;const c=`date-picker-wrap-${Date.now()}`,g=`date-prper-${Date.now()}`;function z(){p.value.focus()}function R(){return k}function V(){return x}return Y(()=>{y.autofocus&&z(),k=document.querySelector(`.${c}`),x=document.querySelector(`.${g}`)}),$({getDatePickerWrapEl:R,getPoppertEl:V}),(q,U)=>{const s=_("el-date-picker");return d(),v("div",{class:M(["date-picker-wrap",c])},[t(s,{ref_key:"dateRef",ref:p,"model-value":r.modelValue,type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期","popper-class":g,"onUpdate:modelValue":U[0]||(U[0]=E=>q.$emit("update:model-value",E))},null,8,["model-value"])],2)}}},be=X(ge,[["__scopeId","data-v-91adbd17"]]),ue={__name:"cell-select",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(r,{expose:$}){const y=r,p=f(null);function k(){p.value.toggleMenu()}function x(){return p.value.popperPaneRef}return Y(()=>{y.autofocus&&k()}),$({getPoppertEl:x}),(c,g)=>{const z=_("el-option"),R=_("el-select");return d(),W(R,{ref_key:"selectRef",ref:p,"model-value":r.modelValue,placeholder:"请选择",clearable:"",filterable:"","onUpdate:modelValue":g[0]||(g[0]=V=>c.$emit("update:model-value",V))},{default:n(()=>[(d(!0),v(ie,null,me(r.options,V=>(d(),W(z,{key:V,label:V,value:V},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}},he={__name:"textarea-popover",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0},virtualRef:{type:HTMLElement,default:void 0}},emits:["update:model-value"],setup(r,{expose:$,emit:y}){const p=r,k=f(null),x=f(null);function c(){x.value.focus()}function g(){const R=p.modelValue.trim();y("update:model-value",R)}function z(){return k.value.popperRef.contentRef}return Y(()=>{p.autofocus&&c()}),$({getPopoverEl:z}),(R,V)=>{const q=_("el-input"),U=_("el-popover");return d(),W(U,{ref_key:"popoverRef",ref:k,visible:"","virtual-ref":r.virtualRef,trigger:"click","virtual-triggering":"",placement:"bottom-start",width:200},{default:n(()=>[t(q,{ref_key:"inputRef",ref:x,"model-value":r.modelValue,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入","onUpdate:modelValue":V[0]||(V[0]=s=>R.$emit("update:model-value",s)),onBlur:g},null,8,["model-value"])]),_:1},8,["virtual-ref"])}}};const S=r=>(se("data-v-1630520f"),r=r(),re(),r),Re={class:"mg-top-10"},Ve=S(()=>h("i",{class:"required"},"*",-1)),Ce=S(()=>h("span",{class:"label"},"日期",-1)),xe=S(()=>h("i",{class:"required"},"*",-1)),Ee=S(()=>h("span",{class:"label"},"名字",-1)),Be=S(()=>h("i",{class:"required"},"*",-1)),Pe=S(()=>h("span",{class:"label"},"省份",-1)),Se=S(()=>h("i",{class:"required"},"*",-1)),$e=S(()=>h("span",{class:"label"},"城市",-1)),ze=S(()=>h("i",{class:"required"},"*",-1)),De=S(()=>h("span",{class:"label"},"地址",-1)),we=S(()=>h("span",{class:"label"},"邮编",-1)),Ue={key:1,class:"no-editor tooltip"},Ie=S(()=>h("span",{class:"label"},"备注",-1)),qe={key:1,class:"no-editor tooltip"},Me={__name:"index",setup(r){const $=[{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""}],y=f(null),p=f(!1),k=f(null),x=f(""),c=f([{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""}]),g=[{province:"黑龙江",citys:["哈尔滨","齐齐哈尔","鸡西","鹤岗"]},{province:"吉林",citys:["长春","通化","白山","四平"]},{province:"辽宁",citys:["辽阳","大连","鞍山","抚顺"]}];let z=[],R=[];const V=["date","name","province","city","address","zip","remark"],q=["date","name","province","city","address"],U=f([]);c.value.forEach(o=>{ee(o.id)});const s=f(""),E=f(""),m=f("");let C=null,D=[];const w=f(null),A=f(null),F=f(null);let H=!0;const Z=f(null),T=f(null);function ee(o){let e={id:o};V.forEach(l=>{e[l]=""}),U.value.push(e)}function L(o,e){const l=U.value.find(u=>u.id===o);if(l)return l[e]}function O(o,e,l){const u=U.value.find(i=>i.id===o);u&&(u[e]=l)}function de(o,e,l,u){var B;const i=e.property;if(V.includes(i)){if(i==="remark"&&T.value){j();return}if(!((B=D[0])!=null&&B.contains(u.target))){if(j(),i==="province")z=g.map(b=>b.province);else if(i==="city")if(o.province){const{citys:b}=g.find(N=>N.province===o.province);R=b}else R=[];else i==="remark"&&(T.value=l);p.value=!1,C=o,E.value=o.id,m.value=i,s.value=o[i],H=!0,ae(()=>{D=[w.value],i==="date"?D.push(A.value.getPoppertEl()):i==="province"||i==="city"?D.push(F.value.getPoppertEl()):i==="remark"&&D.push(Z.value.getPopoverEl())})}}}function j(){D.length!==0&&(q.includes(m.value)&&(s.value?C[m.value]!==s.value&&O(C.id,m.value,"success"):O(C.id,m.value,"error")),C[m.value]=s.value,C=null,E.value="",m.value="",s.value="",D=[],H=!0,T.value=null)}function te(){if(!s.value){C.city="";return}const o=C.city,{citys:e}=g.find(l=>l.province===s.value);e.includes(o)||(C.city="")}function ce(){m.value==="province"&&te(),j(),c.value.push({id:`${Date.now()}-${c.value.length+1}`,date:"",name:"",province:"",city:"",address:"",zip:"",remark:""}),C=c.value[c.value.length-1],E.value=C.id,m.value="date",s.value=C.date,H=!1,ee(C.id),ae(()=>{const o=y.value.layout.table.refs.tableBody;y.value.setScrollTop(o.clientHeight),y.value.setScrollLeft(0),D=[w.value,A.value.getPoppertEl()]})}function pe(o){const e=c.value.findIndex(l=>l.id===o);e>=0&&c.value.splice(e,1)}function le(o){let e=!1;if(c.value.forEach(l=>{for(const u in l)q.includes(u)&&!l[u]&&(e=!0,O(l.id,u,"error"))}),e){ne.alert("必填项未填写","",{confirmButtonText:"确认",type:"error",callback:()=>{}});return}new Promise(l=>{setTimeout(()=>{l()},500)}).then(()=>{o&&o()})}function fe(){let o=!1;if(c.value.length!==$.length)return o=!0,o;let e=null;return c.value.some(l=>{if(e=$.find(u=>u.id===l.id),e){for(const u in e)if(e[u]!==l[u])return o=!0,!0}else return o=!0,!0}),o}function oe(o){D.length===0||D.some(l=>l==null?void 0:l.contains(o.target))||(m.value==="province"&&te(),j())}function ve(o,e,l){const u=l.querySelector(".tooltip");if(!u)return;const i=document.createRange();i.setStart(u,0),i.setEnd(u,u.childNodes.length);const B=i.getBoundingClientRect().width,b=window.getComputedStyle(u),N=parseInt(b.getPropertyValue("padding-left"))+parseInt(b.getPropertyValue("padding-right")),G=u.getBoundingClientRect().width;B+N-G>.02&&(k.value=u,p.value=!0,x.value=u.innerText)}return Y(()=>{document.addEventListener("mouseup",oe)}),_e(()=>{document.removeEventListener("mouseup",oe)}),ye((o,e,l)=>{if(fe()){ne.confirm("是否保存数据","",{confirmButtonText:"保存",cancelButtonText:"取消",type:"info",distinguishCancelAndClose:!0,callback:u=>{u==="confirm"?le(()=>{l()}):u==="cancel"&&l()}});return}l()}),(o,e)=>{const l=_("el-button"),u=_("el-row"),i=_("el-table-column"),B=_("EditPen"),b=_("el-icon"),N=_("el-table"),G=_("el-tooltip");return d(),v("div",null,[t(u,{justify:"end"},{default:n(()=>[t(l,{type:"primary",plain:"",onClick:ce},{default:n(()=>[J("新增")]),_:1})]),_:1}),h("div",Re,[t(N,{ref_key:"tableRef",ref:y,data:c.value,border:"",stripe:"","max-height":400,onCellClick:de,onCellMouseEnter:ve},{default:n(()=>[t(i,{type:"index",fixed:"",label:"序号",width:"70"}),t(i,{prop:"date",label:"日期","min-width":"140","class-name":"editor-column"},{header:n(()=>[Ve,Ce,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="date"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"editor"},[t(be,{ref_key:"cellDateRef",ref:A,modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=P=>s.value=P),autofocus:K(H)},null,8,["modelValue","autofocus"])],512)):(d(),v("div",{key:1,class:M(["no-editor","tooltip",L(a.id,"date")])},I(a.date),3))]),_:1}),t(i,{prop:"name",label:"名字","min-width":"120","class-name":"editor-column"},{header:n(()=>[xe,Ee,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="name"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"editor"},[t(Q,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=P=>s.value=P)},null,8,["modelValue"])],512)):(d(),v("div",{key:1,class:M(["no-editor","tooltip",L(a.id,"name")])},I(a.name),3))]),_:1}),t(i,{prop:"province",label:"省份","min-width":"120","class-name":"editor-column"},{header:n(()=>[Be,Pe,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="province"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"editor"},[t(ue,{ref_key:"cellSelectRef",ref:F,modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=P=>s.value=P),options:K(z)},null,8,["modelValue","options"])],512)):(d(),v("div",{key:1,class:M(["no-editor","tooltip",L(a.id,"province")])},I(a.province),3))]),_:1}),t(i,{prop:"city",label:"城市","min-width":"120","class-name":"editor-column"},{header:n(()=>[Se,$e,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="city"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"editor"},[t(ue,{ref_key:"cellSelectRef",ref:F,modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=P=>s.value=P),options:K(R)},null,8,["modelValue","options"])],512)):(d(),v("div",{key:1,class:M(["no-editor","tooltip",L(a.id,"city")])},I(a.city),3))]),_:1}),t(i,{prop:"address",label:"地址","min-width":"170","class-name":"editor-column"},{header:n(()=>[ze,De,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="address"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"editor"},[t(Q,{modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=P=>s.value=P)},null,8,["modelValue"])],512)):(d(),v("div",{key:1,class:M(["no-editor","tooltip",L(a.id,"address")])},I(a.address),3))]),_:1}),t(i,{prop:"zip",label:"邮编","min-width":"120","class-name":"editor-column"},{header:n(()=>[we,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="zip"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"editor"},[t(Q,{modelValue:s.value,"onUpdate:modelValue":e[5]||(e[5]=P=>s.value=P)},null,8,["modelValue"])],512)):(d(),v("div",Ue,I(a.zip),1))]),_:1}),t(i,{prop:"remark",label:"备注","min-width":"180","class-name":"editor-column"},{header:n(()=>[Ie,t(b,null,{default:n(()=>[t(B)]),_:1})]),default:n(({row:a})=>[E.value===a.id&&m.value==="remark"?(d(),v("div",{key:0,ref_key:"editCellRef",ref:w,class:"popover-edit"},I(a.remark),513)):(d(),v("div",qe,I(a.remark),1))]),_:1}),t(i,{label:"操作","min-width":"70",fixed:"right"},{default:n(({row:a})=>[t(u,null,{default:n(()=>[t(l,{link:"",type:"primary",onClick:P=>pe(a.id)},{default:n(()=>[J("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),t(G,{visible:p.value,"onUpdate:visible":e[6]||(e[6]=a=>p.value=a),"virtual-ref":k.value,"virtual-triggering":"",content:x.value,placement:"top",teleported:!1},null,8,["visible","virtual-ref","content"]),T.value?(d(),W(he,{key:0,ref_key:"textareaPopoverRef",ref:Z,modelValue:s.value,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value=a),"virtual-ref":T.value},null,8,["modelValue","virtual-ref"])):ke("",!0)]),t(u,{justify:"center",class:"mg-top-20"},{default:n(()=>[t(l,{type:"primary",onClick:e[8]||(e[8]=a=>le())},{default:n(()=>[J("保存")]),_:1})]),_:1})])}}},Te=X(Me,[["__scopeId","data-v-1630520f"]]);const Le=r=>(se("data-v-81755b78"),r=r(),re(),r),Ne=Le(()=>h("div",{class:"title"},"表格编辑",-1)),We={__name:"index",setup(r){return($,y)=>{const p=_("el-tab-pane"),k=_("el-tabs");return d(),v(ie,null,[Ne,t(k,{"model-value":"1"},{default:n(()=>[t(p,{label:"单元格编辑",name:"1"},{default:n(()=>[t(Te)]),_:1})]),_:1})],64)}}},He=X(We,[["__scopeId","data-v-81755b78"]]);export{He as default};
