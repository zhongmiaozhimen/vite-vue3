import{_ as Q}from"./index-c21961e0.js";import{_ as U,a as h,s as A,o as H,c as E,f as F,n as N,F as X,m as Y,x as Z,y as ee,e as te,t as le,h as oe,j as ae,z as O}from"./index-517f5019.js";const ie={class:"virtual-list"},ne={__name:"index",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},cache:{type:Number,default:2},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0},showOverflowTooltip:{type:Boolean,default:!1},autoResetScrollBar:{type:Boolean,default:!1}},setup(p,{expose:D}){const o=p;let d=[],s=0;const c=h(null);let u=0,I=0,_=0;const m=h([]);let g=0,n=0,f=0;const x=h(0),w=h(0),T=h(null),y=h(null);let v=[],B=!1;const i=h(null);function W(){let e=o.cache+o.buffer*2;return e<2&&(e=2),e}function j(){const e=y.value.children,t=[];for(let l=0;l<e.length;l++)t.push(e[l].getBoundingClientRect().height);for(let l=t.length;l<d.length;l++)t.push(u);return t}function R(){if(!T.value)return 0;const e=T.value.scrollTop;if(e===0)return 0;let t=0;if(o.fixed)t=Math.floor(e/u);else{let l=0;for(let a=0;a<v.length;a++){if(l+=v[a],e===l){t=a+1;break}if(e<l){t=a;break}}}return t}function V(e){let t=e-Math.floor(_/2);const l=s-g;t<0?t=0:t>l&&(t=l);let a=t+g-1;const b=s-1;return a>b&&(a=b),{listStartIndex:t,listEndIndex:a}}function k(){m.value=d,x.value=0,w.value=0}function q(){if(d=o.data.map((e,t)=>({id:`${Date.now()}-${t}`,data:e})),s=d.length,c.value=o.height||o.maxHeight,s===0||!c.value){k();return}o.fixed?(m.value=d.slice(0,g||1),O(()=>{u=y.value.children[0].clientHeight,C()})):(u=o.minItemHeight,C())}function C(){if(I=Math.ceil(c.value/u),_=W(),g=I+_,g>=s){k();return}const e=R(),{listStartIndex:t,listEndIndex:l}=V(e);n=t,f=l,x.value=n*u,w.value=(s-f-1)*u,m.value=d.slice(n,f+1),o.fixed||O(()=>{v=j()})}function G(){let e=R();const t=e-n;if(f+1-e-I>o.buffer&&t>o.buffer)return;const{listStartIndex:a,listEndIndex:b}=V(e);if(a!==n)if(n=a,f=b,m.value=d.slice(n,f+1),o.fixed)x.value=n*u,w.value=(s-f-1)*u;else{let $=0;for(let r=0;r<n;r++)$+=v[r];x.value=$;let z=0;for(let r=f+1;r<s;r++)z+=v[r];w.value=z,O(()=>{const r=y.value.children,L=[];for(let S=0;S<r.length;S++)L.push(r[S].getBoundingClientRect().height);v.splice(n,L.length,...L)})}}function M(){T.value&&(T.value.scrollTop=0)}A(()=>o.data,()=>{o.autoResetScrollBar&&M(),q()},{immediate:!0,deep:!0}),A([()=>o.height,()=>o.maxHeight],()=>{if(c.value=o.height||o.maxHeight,!c.value){k();return}C()});function J(){o.showOverflowTooltip&&(i.value=null),!B&&(B=!0,requestAnimationFrame(()=>{B=!1}),!(g>=s)&&G())}function K(e){if(!(!o.showOverflowTooltip||e.target===e.currentTarget||i.value&&(i.value.contains(e.fromElement)||!i.value.contains(e.target)))&&(i.value=e.target,e.target.parentElement!==e.currentTarget)){const t=e.currentTarget.children;for(let l=0;l<t.length;l++)if(t[l].contains(e.target)){i.value=t[l];break}}}function P(e){!o.showOverflowTooltip||i.value&&(!i.value.contains(e.target)||i.value.contains(e.toElement))||(i.value=null)}return D({resetScrollBar:M}),(e,t)=>(H(),E("div",ie,[F("div",{ref_key:"listWrapRef",ref:T,class:"list-wrap",style:N({height:p.height?p.height+"px":"","max-height":c.value?c.value+"px":""}),onScroll:J},[F("ul",{ref_key:"listRef",ref:y,style:N({"padding-top":x.value+"px","padding-bottom":w.value+"px"}),onMouseover:K,onMouseout:P},[(H(!0),E(X,null,Y(m.value,l=>(H(),E("li",{key:l.id,class:Z(["list-item",{tooltip:o.showOverflowTooltip}]),style:N({"white-space":p.fixed?"nowrap":"normal","word-break":p.fixed?"normal":"break-all",overflow:p.fixed?"hidden":"visible"})},[ee(e.$slots,"default",{item:l.data},()=>[te(le(l),1)],!0)],6))),128))],36)],36),o.showOverflowTooltip?(H(),oe(Q,{key:0,"mouseenter-el":i.value,enterable:!1,"teleport-to-body":!1},null,8,["mouseenter-el"])):ae("",!0)]))}},ue=U(ne,[["__scopeId","data-v-1a43e473"]]);export{ue as V};
