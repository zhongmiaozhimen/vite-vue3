import{r,A as Y,k as y,o as i,h as W,_ as Q,c as v,l as e,e as q,m as o,F as ue,d as ve,B as me,C as te,g as oe,a as k,D as J,t as M,v as _e,E as ye,i as ke,n as ae,p as se,q as ie}from"./index-50b49a0b.js";const K={__name:"cell-input",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(s,{emit:R}){const g=s,c=r(null);function _(){c.value.focus()}function V(){const p=g.modelValue.trim();R("update:model-value",p)}return Y(()=>{g.autofocus&&_()}),(p,h)=>{const w=y("el-input");return i(),W(w,{ref_key:"inputRef",ref:c,"model-value":s.modelValue,placeholder:"请输入","onUpdate:modelValue":h[0]||(h[0]=C=>p.$emit("update:model-value",C)),onBlur:V},null,8,["model-value"])}}};const ge={__name:"cell-date",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(s,{expose:R}){const g=s,c=r(null);let _=null,V=null;const p=`date-picker-wrap-${Date.now()}`,h=`date-prper-${Date.now()}`;function w(){c.value.focus()}function C(){return _}function E(){return V}return Y(()=>{g.autofocus&&w(),_=document.querySelector(`.${p}`),V=document.querySelector(`.${h}`)}),R({getDatePickerWrapEl:C,getPoppertEl:E}),(I,z)=>{const a=y("el-date-picker");return i(),v("div",{class:q(["date-picker-wrap",p])},[e(a,{ref_key:"dateRef",ref:c,"model-value":s.modelValue,type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期","popper-class":h,"onUpdate:modelValue":z[0]||(z[0]=S=>I.$emit("update:model-value",S))},null,8,["model-value"])],2)}}},he=Q(ge,[["__scopeId","data-v-91adbd17"]]),ne={__name:"cell-select",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(s,{expose:R}){const g=s,c=r(null);function _(){c.value.toggleMenu()}function V(){return c.value.popperPaneRef}return Y(()=>{g.autofocus&&_()}),R({getPoppertEl:V}),(p,h)=>{const w=y("el-option"),C=y("el-select");return i(),W(C,{ref_key:"selectRef",ref:c,"model-value":s.modelValue,placeholder:"请选择",clearable:"",filterable:"","onUpdate:modelValue":h[0]||(h[0]=E=>p.$emit("update:model-value",E))},{default:o(()=>[(i(!0),v(ue,null,ve(s.options,E=>(i(),W(w,{key:E,label:E,value:E},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}},be={__name:"textarea-popover",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0},virtualRef:{type:HTMLElement,default:void 0}},emits:["update:model-value"],setup(s,{expose:R,emit:g}){const c=s,_=r(null),V=r(null);function p(){V.value.focus()}function h(){const C=c.modelValue.trim();g("update:model-value",C)}function w(){return _.value.popperRef.contentRef}return Y(()=>{c.autofocus&&p()}),R({getPopoverEl:w}),(C,E)=>{const I=y("el-input"),z=y("el-popover");return i(),W(z,{ref_key:"popoverRef",ref:_,visible:"","virtual-ref":s.virtualRef,trigger:"click","virtual-triggering":"",placement:"bottom-start",width:200},{default:o(()=>[e(I,{ref_key:"inputRef",ref:V,"model-value":s.modelValue,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入","onUpdate:modelValue":E[0]||(E[0]=a=>C.$emit("update:model-value",a)),onBlur:h},null,8,["model-value"])]),_:1},8,["virtual-ref"])}}};const $=s=>(se("data-v-38b2283d"),s=s(),ie(),s),Re={class:"mg-top-10"},Ve=$(()=>k("i",{class:"required"},"*",-1)),Ce=$(()=>k("span",{class:"label"},"日期",-1)),Ee=$(()=>k("i",{class:"required"},"*",-1)),xe=$(()=>k("span",{class:"label"},"名字",-1)),Se=$(()=>k("i",{class:"required"},"*",-1)),Pe=$(()=>k("span",{class:"label"},"省份",-1)),$e=$(()=>k("i",{class:"required"},"*",-1)),Be=$(()=>k("span",{class:"label"},"城市",-1)),we=$(()=>k("i",{class:"required"},"*",-1)),De=$(()=>k("span",{class:"label"},"地址",-1)),Ue=$(()=>k("span",{class:"label"},"邮编",-1)),ze={key:1,class:"no-editor tooltip"},Me=$(()=>k("span",{class:"label"},"备注",-1)),qe={key:1,class:"no-editor tooltip"},Ie={class:"tooltip-wrap"},Le={__name:"index",setup(s){const R=r(null),g=r(!1),c=r(null),_=r(""),V=r(!0),p=r([{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""}]),h=[{province:"黑龙江",citys:["哈尔滨","齐齐哈尔","鸡西","鹤岗"]},{province:"吉林",citys:["长春","通化","白山","四平"]},{province:"辽宁",citys:["辽阳","大连","鞍山","抚顺"]}];let w=[],C=[];const E=["date","name","province","city","address","zip","remark"],I=["date","name","province","city","address"],z=r([]);p.value.forEach(u=>{Z(u.id)});const a=r(""),S=r(""),m=r("");let x=null,D=[];const U=r(null),A=r(null),F=r(null);let H=!0;const X=r(null),L=r(null);function Z(u){let l={id:u};E.forEach(d=>{l[d]=""}),z.value.push(l)}function T(u,l){const d=z.value.find(f=>f.id===u);if(d)return d[l]}function O(u,l,d){const f=z.value.find(n=>n.id===u);f&&(f[l]=d)}function de(u,l,d,f){var P;const n=l.property;if(E.includes(n)){if(n==="remark"&&L.value){j();return}if(!((P=D[0])!=null&&P.contains(f.target))){if(j(),n==="province")w=h.map(b=>b.province);else if(n==="city")if(u.province){const{citys:b}=h.find(N=>N.province===u.province);C=b}else C=[];else n==="remark"&&(L.value=d);V.value=!1,x=u,S.value=u.id,m.value=n,a.value=u[n],H=!0,ae(()=>{D=[U.value],n==="date"?D.push(A.value.getPoppertEl()):n==="province"||n==="city"?D.push(F.value.getPoppertEl()):n==="remark"&&D.push(X.value.getPopoverEl())})}}}function j(){D.length!==0&&(I.includes(m.value)&&(a.value?x[m.value]!==a.value&&O(x.id,m.value,"success"):O(x.id,m.value,"error")),x[m.value]=a.value,x=null,S.value="",m.value="",a.value="",D=[],H=!0,L.value=null)}function ee(){if(!a.value){x.city="";return}const u=x.city,{citys:l}=h.find(d=>d.province===a.value);l.includes(u)||(x.city="")}function re(){m.value==="province"&&ee(),j(),p.value.push({id:`${Date.now()}-${p.value.length+1}`,date:"",name:"",province:"",city:"",address:"",zip:"",remark:""}),x=p.value[p.value.length-1],S.value=x.id,m.value="date",a.value=x.date,H=!1,Z(x.id),ae(()=>{const u=R.value.layout.table.refs.tableBody;R.value.setScrollTop(u.clientHeight),R.value.setScrollLeft(0),D=[U.value,A.value.getPoppertEl()]})}function ce(){let u=!1;p.value.forEach(l=>{for(const d in l)l[d]||(u=!0,O(l.id,d,"error"))})}function le(u){D.length===0||D.some(d=>d==null?void 0:d.contains(u.target))||(m.value==="province"&&ee(),j())}function pe(u,l,d){const f=d.querySelector(".tooltip");if(!f)return;const n=document.createRange();n.setStart(f,0),n.setEnd(f,f.childNodes.length);const P=n.getBoundingClientRect().width,b=window.getComputedStyle(f),N=parseInt(b.getPropertyValue("padding-left"))+parseInt(b.getPropertyValue("padding-right")),G=f.getBoundingClientRect().width;P+N-G>.02&&(V.value=!0,c.value=f,g.value=!0,_.value=f.innerText)}function fe(){g.value=!1,_.value="",c.value=null}return Y(()=>{document.addEventListener("mouseup",le)}),me(()=>{document.removeEventListener("mouseup",le)}),(u,l)=>{const d=y("el-button"),f=y("el-row"),n=y("el-table-column"),P=y("EditPen"),b=y("el-icon"),N=y("el-table"),G=y("el-tooltip");return i(),v("div",null,[e(f,{justify:"end"},{default:o(()=>[e(d,{type:"primary",plain:"",onClick:te(re,["stop"])},{default:o(()=>[oe("新增")]),_:1},8,["onClick"])]),_:1}),k("div",Re,[e(N,{ref_key:"tableRef",ref:R,data:p.value,border:"",stripe:"","max-height":400,onCellClick:de,onCellMouseEnter:pe,onCellMouseLeave:fe},{default:o(()=>[e(n,{type:"index",fixed:"",label:"序号",width:"70"}),e(n,{prop:"date",label:"日期","min-width":"140","class-name":"editor-column"},{header:o(()=>[Ve,Ce,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="date"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"editor"},[e(he,{ref_key:"cellDateRef",ref:A,modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=B=>a.value=B),autofocus:J(H)},null,8,["modelValue","autofocus"])],512)):(i(),v("div",{key:1,class:q(["no-editor","tooltip",T(t.id,"date")])},M(t.date),3))]),_:1}),e(n,{prop:"name",label:"名字","min-width":"120","class-name":"editor-column"},{header:o(()=>[Ee,xe,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="name"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"editor"},[e(K,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=B=>a.value=B)},null,8,["modelValue"])],512)):(i(),v("div",{key:1,class:q(["no-editor","tooltip",T(t.id,"name")])},M(t.name),3))]),_:1}),e(n,{prop:"province",label:"省份","min-width":"120","class-name":"editor-column"},{header:o(()=>[Se,Pe,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="province"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"editor"},[e(ne,{ref_key:"cellSelectRef",ref:F,modelValue:a.value,"onUpdate:modelValue":l[2]||(l[2]=B=>a.value=B),options:J(w)},null,8,["modelValue","options"])],512)):(i(),v("div",{key:1,class:q(["no-editor","tooltip",T(t.id,"province")])},M(t.province),3))]),_:1}),e(n,{prop:"city",label:"城市","min-width":"120","class-name":"editor-column"},{header:o(()=>[$e,Be,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="city"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"editor"},[e(ne,{ref_key:"cellSelectRef",ref:F,modelValue:a.value,"onUpdate:modelValue":l[3]||(l[3]=B=>a.value=B),options:J(C)},null,8,["modelValue","options"])],512)):(i(),v("div",{key:1,class:q(["no-editor","tooltip",T(t.id,"city")])},M(t.city),3))]),_:1}),e(n,{prop:"address",label:"地址","min-width":"170","class-name":"editor-column"},{header:o(()=>[we,De,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="address"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"editor"},[e(K,{modelValue:a.value,"onUpdate:modelValue":l[4]||(l[4]=B=>a.value=B)},null,8,["modelValue"])],512)):(i(),v("div",{key:1,class:q(["no-editor","tooltip",T(t.id,"address")])},M(t.address),3))]),_:1}),e(n,{prop:"zip",label:"邮编","min-width":"120","class-name":"editor-column"},{header:o(()=>[Ue,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="zip"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"editor"},[e(K,{modelValue:a.value,"onUpdate:modelValue":l[5]||(l[5]=B=>a.value=B)},null,8,["modelValue"])],512)):(i(),v("div",ze,M(t.zip),1))]),_:1}),e(n,{prop:"remark",label:"备注","min-width":"180","class-name":"editor-column"},{header:o(()=>[Me,e(b,null,{default:o(()=>[e(P)]),_:1})]),default:o(({row:t})=>[S.value===t.id&&m.value==="remark"?(i(),v("div",{key:0,ref_key:"editCellRef",ref:U,class:"popover-edit"},M(t.remark),513)):(i(),v("div",qe,M(t.remark),1))]),_:1})]),_:1},8,["data"]),_e(k("div",Ie,[e(G,{visible:g.value,"onUpdate:visible":l[6]||(l[6]=t=>g.value=t),"virtual-ref":c.value,"virtual-triggering":"",content:_.value,placement:"top",teleported:!1},null,8,["visible","virtual-ref","content"])],512),[[ye,V.value]]),L.value?(i(),W(be,{key:0,ref_key:"textareaPopoverRef",ref:X,modelValue:a.value,"onUpdate:modelValue":l[7]||(l[7]=t=>a.value=t),"virtual-ref":L.value},null,8,["modelValue","virtual-ref"])):ke("",!0)]),e(f,{justify:"center",class:"mg-top-20"},{default:o(()=>[e(d,{type:"primary",onClick:te(ce,["stop"])},{default:o(()=>[oe("保存")]),_:1},8,["onClick"])]),_:1})])}}},Te=Q(Le,[["__scopeId","data-v-38b2283d"]]);const Ne=s=>(se("data-v-81755b78"),s=s(),ie(),s),We=Ne(()=>k("div",{class:"title"},"表格编辑",-1)),Ye={__name:"index",setup(s){return(R,g)=>{const c=y("el-tab-pane"),_=y("el-tabs");return i(),v(ue,null,[We,e(_,{"model-value":"1"},{default:o(()=>[e(c,{label:"单元格编辑",name:"1"},{default:o(()=>[e(Te)]),_:1})]),_:1})],64)}}},je=Q(Ye,[["__scopeId","data-v-81755b78"]]);export{je as default};
