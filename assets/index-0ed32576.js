import{_ as Q}from"./index-0063d12b.js";import{_ as U,a as h,l as F,o as H,c as E,f as q,n as N,F as X,k as Y,m as Z,q as ee,e as te,t as le,h as oe,i as ie,s as O}from"./index-4fb89d43.js";const ae={class:"virtual-list"},ne={__name:"index",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},cache:{type:Number,default:2},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0},showOverflowTooltip:{type:Boolean,default:!1},autoResetScrollBar:{type:Boolean,default:!1}},setup(p,{expose:z}){const o=p;let d=[],s=0;const c=h(null);let u=0,I=0,_=0;const m=h([]);let g=0,n=0,f=0;const x=h(0),w=h(0),T=h(null),y=h(null);let v=[],k=!1;const a=h(null);function D(){let e=o.cache+o.buffer*2;return e<2&&(e=2),e}function W(){const e=y.value.children,t=[];for(let l=0;l<e.length;l++)t.push(e[l].getBoundingClientRect().height);for(let l=t.length;l<d.length;l++)t.push(u);return t}function R(){if(!T.value)return 0;const e=T.value.scrollTop;if(e===0)return 0;let t=0;if(o.fixed)t=Math.floor(e/u);else{let l=0;for(let i=0;i<v.length;i++){if(l+=v[i],e===l){t=i+1;break}if(e<l){t=i;break}}}return t}function V(e){let t=e-Math.floor(_/2);const l=s-g;t<0?t=0:t>l&&(t=l);let i=t+g-1;const b=s-1;return i>b&&(i=b),{listStartIndex:t,listEndIndex:i}}function B(){m.value=d,x.value=0,w.value=0}function j(){if(d=o.data.map((e,t)=>({id:`${Date.now()}-${t}`,data:e})),s=d.length,c.value=o.height||o.maxHeight,s===0||!c.value){B();return}o.fixed?(m.value=d.slice(0,g||1),O(()=>{u=y.value.children[0].clientHeight,C()})):(u=o.minItemHeight,C())}function C(){if(I=Math.ceil(c.value/u),_=D(),g=I+_,g>=s){B();return}const e=R(),{listStartIndex:t,listEndIndex:l}=V(e);n=t,f=l,x.value=n*u,w.value=(s-f-1)*u,m.value=d.slice(n,f+1),o.fixed||O(()=>{v=W()})}function G(){let e=R();const t=e-n;if(f+1-e-I>o.buffer&&t>o.buffer)return;const{listStartIndex:i,listEndIndex:b}=V(e);if(i!==n)if(n=i,f=b,m.value=d.slice(n,f+1),o.fixed)x.value=n*u,w.value=(s-f-1)*u;else{let $=0;for(let r=0;r<n;r++)$+=v[r];x.value=$;let A=0;for(let r=f+1;r<s;r++)A+=v[r];w.value=A,O(()=>{const r=y.value.children,L=[];for(let S=0;S<r.length;S++)L.push(r[S].getBoundingClientRect().height);v.splice(n,L.length,...L)})}}function M(){T.value&&(T.value.scrollTop=0)}F(()=>o.data,()=>{o.autoResetScrollBar&&M(),j()},{immediate:!0,deep:!0}),F([()=>o.height,()=>o.maxHeight],()=>{if(c.value=o.height||o.maxHeight,!c.value){B();return}C()});function J(){o.showOverflowTooltip&&(a.value=null),!k&&(k=!0,requestAnimationFrame(()=>{k=!1}),!(g>=s)&&G())}function K(e){if(!(!o.showOverflowTooltip||e.target===e.currentTarget||a.value&&(a.value.contains(e.fromElement)||!a.value.contains(e.target)))&&(a.value=e.target,e.target.parentElement!==e.currentTarget)){const t=e.currentTarget.children;for(let l=0;l<t.length;l++)if(t[l].contains(e.target)){a.value=t[l];break}}}function P(e){!o.showOverflowTooltip||a.value&&(!a.value.contains(e.target)||a.value.contains(e.toElement))||(a.value=null)}return z({resetScrollBar:M}),(e,t)=>(H(),E("div",ae,[q("div",{ref_key:"listWrapRef",ref:T,class:"list-wrap",style:N({height:p.height?p.height+"px":"","max-height":c.value?c.value+"px":""}),onScroll:J},[q("ul",{ref_key:"listRef",ref:y,style:N({"padding-top":x.value+"px","padding-bottom":w.value+"px"}),onMouseover:K,onMouseout:P},[(H(!0),E(X,null,Y(m.value,l=>(H(),E("li",{key:l.id,class:Z(["list-item",{tooltip:o.showOverflowTooltip}]),style:N({"white-space":p.fixed?"nowrap":"normal","word-break":p.fixed?"normal":"break-all",overflow:p.fixed?"hidden":"visible"})},[ee(e.$slots,"default",{item:l.data},()=>[te(le(l),1)],!0)],6))),128))],36)],36),o.showOverflowTooltip?(H(),oe(Q,{key:0,"mouseenter-el":a.value,enterable:!1,"teleport-to-body":!1},null,8,["mouseenter-el"])):ie("",!0)]))}},ue=U(ne,[["__scopeId","data-v-1a43e473"]]);export{ue as V};
