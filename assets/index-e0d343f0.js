import{_ as k,r as _,n as j,w as A,o as I,c as $,a as L,b as F,F as D,d as ee,e as te,f as le,g as M,t as U,h as ie,T as ae,i as ne,j as q,k as H,l as o,m as c,p as oe,q as ue}from"./index-b104e244.js";const re={class:"virtual-list"},se={__name:"virtual-list",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0},showOverflowTooltip:{type:Boolean,default:!1}},setup(m){const e=m;let d=W(),a=d.length;const h=_(e.height?null:e.maxHeight);let p=0,v=0,l=0;const i=_([]);let u=0,f=0;const w=_(0),b=_(0);let n=0;const S=_(null),T=_(null);let B=[],O=!1;const g=_(null);P();function W(){return e.data.map((t,r)=>({id:`${Date.now()}-${r}`,data:t}))}function C(){i.value=d,w.value=0,b.value=0,n=0}function J(){if(!e.height&&!e.maxHeight)return;let t=0;return e.fixed?e.height?t=Math.ceil(e.height/p):t=Math.ceil(e.maxHeight/p):e.height?t=Math.ceil(e.height/e.minItemHeight):t=Math.ceil(e.maxHeight/e.minItemHeight),t}function K(){const t=T.value.children,r=[];for(let s=0;s<t.length;s++)r.push(t[s].getBoundingClientRect().height);for(let s=r.length;s<d.length;s++)r.push(e.minItemHeight);return r}function P(){if(a<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){C();return}if(e.fixed){i.value=d.slice(0,1),j(()=>{p=T.value.children[0].clientHeight,N()});return}N()}function N(){if(v=J(),l=e.buffer*2||1,v+l>=a){C();return}const t=v+l;u=0,f=t-1,w.value=0,e.fixed?b.value=(a-t)*p:b.value=(a-t)*e.minItemHeight,i.value=d.slice(u,f+1),n=0,e.fixed||j(()=>{B=K()})}function Q(t){let r=0;if(e.fixed)r=Math.floor(t/p);else{let y=0;for(let V=0;V<B.length;V++){if(y+=B[V],t===y){r=V+1;break}if(t<y){r=V;break}}}if(t>n){if(n=t,f+1-r-v>e.buffer)return}else if(t<n){if(n=t,r-u>e.buffer)return}else return;l%2?u=r-Math.floor(l/2):u=r-l/2;const s=a-i.value.length;u<0?u=0:u>s&&(u=s),f=u+i.value.length-1;const z=a-1;if(f>z&&(f=z),i.value=d.slice(u,f+1),e.fixed)w.value=u*p,b.value=(a-f-1)*p;else{let y=0;for(let x=0;x<u;x++)y+=B[x];w.value=y;let V=0;for(let x=f+1;x<a;x++)V+=B[x];b.value=V,j(()=>{const x=T.value.children,E=[];for(let R=0;R<x.length;R++)E.push(x[R].getBoundingClientRect().height);B.splice(u,E.length,...E)})}}A(()=>e.data,()=>{if(S.value&&(S.value.scrollTop=0),d=W(),a=d.length,a<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){C();return}N()}),A([()=>e.height,()=>e.maxHeight],()=>{if(a<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){C();return}h.value=e.height?null:e.maxHeight,N()});function X(t){e.showOverflowTooltip&&(g.value=null),!(a<=2||!e.height&&!e.maxHeight||i.value.length>=a||!e.fixed&&!e.minItemHeight)&&(O||(O=!0,requestAnimationFrame(()=>{O=!1}),Q(t.target.scrollTop)))}function Y(t){if(!(!e.showOverflowTooltip||t.target===t.currentTarget||g.value&&(g.value.contains(t.fromElement)||!g.value.contains(t.target)))&&(g.value=t.target,t.target.parentElement!==t.currentTarget)){const r=t.currentTarget.children;for(let s=0;s<r.length;s++)if(r[s].contains(t.target)){g.value=r[s];break}}}function Z(t){!e.showOverflowTooltip||g.value&&(!g.value.contains(t.target)||g.value.contains(t.toElement))||(g.value=null)}return(t,r)=>(I(),$("div",re,[L("div",{ref_key:"listWrapRef",ref:S,class:"list-wrap",style:F({height:m.height?m.height+"px":"","max-height":h.value?h.value+"px":""}),onScroll:X},[L("ul",{ref_key:"listRef",ref:T,style:F({"padding-top":w.value+"px","padding-bottom":b.value+"px"}),onMouseover:Y,onMouseout:Z},[(I(!0),$(D,null,ee(i.value,s=>(I(),$("li",{key:s.id,class:te(["list-item",{tooltip:e.showOverflowTooltip}]),style:F({"white-space":m.fixed?"nowrap":"normal","word-break":m.fixed?"normal":"break-all",overflow:m.fixed?"hidden":"visible"})},[le(t.$slots,"default",{items:s.data},()=>[M(U(s),1)],!0)],6))),128))],36)],36),e.showOverflowTooltip?(I(),ie(ae,{key:0,"mouseenter-el":g.value,enterable:!1,"teleport-to-body":!1},null,8,["mouseenter-el"])):ne("",!0)]))}},G=k(se,[["__scopeId","data-v-90d3e280"]]);const de={class:"wrap"},fe=500,ce={__name:"fixed-virtual-list",setup(m){const e=q({total:1e3,buffer:0}),d=_([]),a=_(0);h();function h(){d.value=[];for(let l=1;l<=e.total;l++)d.value.push({msg:`${l} --- ${p()}`});a.value=e.buffer}function p(){const l=["aaa"," bbbb"," cccccccccc"," ddddddddddddddddddddddddddddd"," eeeeeeeeeee"," ff"," gggg"," hhhhhh"," ii"," j"," k"],i=Math.ceil(Math.random()*10);return l.slice(0,i).join("")}function v(l){e[l]!==""&&typeof e[l]=="string"&&(e[l]=e[l].replace(/[^0-9]/g,"").replace(/^0+(?=\d)/,""),e[l]=Number(e[l]))}return(l,i)=>{const u=H("el-input"),f=H("el-form-item"),w=H("el-button"),b=H("el-form");return I(),$("div",null,[o(b,{inline:""},{default:c(()=>[o(f,{label:"列表总数"},{default:c(()=>[o(u,{modelValue:e.total,"onUpdate:modelValue":i[0]||(i[0]=n=>e.total=n),modelModifiers:{number:!0},placeholder:"请输入列表总数",maxlength:"6",onBlur:i[1]||(i[1]=n=>v("total"))},null,8,["modelValue"])]),_:1}),o(f,{label:"缓冲量"},{default:c(()=>[o(u,{modelValue:e.buffer,"onUpdate:modelValue":i[2]||(i[2]=n=>e.buffer=n),modelModifiers:{number:!0},placeholder:"请输入滚动时的缓冲量",maxlength:"5",onBlur:i[3]||(i[3]=n=>v("buffer"))},null,8,["modelValue"])]),_:1}),o(f,null,{default:c(()=>[o(w,{type:"primary",onClick:h},{default:c(()=>[M("更新列表")]),_:1})]),_:1})]),_:1}),L("div",de,[o(G,{data:d.value,"max-height":fe,buffer:a.value,"show-overflow-tooltip":""},{default:c(({items:n})=>[M(U(n.msg),1)]),_:1},8,["data","buffer"])])])}}},me=k(ce,[["__scopeId","data-v-e8486b51"]]);const he={class:"wrap"},pe=500,ge={__name:"dynamic-virtual-list",setup(m){const e=q({total:1e3,buffer:0}),d=_([]),a=_(0);h();function h(){d.value=[];for(let l=1;l<=e.total;l++)d.value.push({msg:`${l} --- ${p()}`});a.value=e.buffer}function p(){const l=["道可道也，非恒道也。","名可名也，非恒名也。","无名万物之始也，有名万物之母也。","故：恒无欲也，以观其眇；","恒有欲也，以观其徼。","两者同出，异名同谓。玄之又玄，众妙之门。","天下皆知美之为美，恶矣，皆知善之为善，斯不善矣。","有无之相生也，难易之相成也，长短之相形也，高下之相盈也，音声之相和也，先后之相随也。","是以圣人居无为之事，行不言之教。","万物作而弗始也，为而弗恃也，成功而弗居也，夫唯弗居，是以弗去。"],i=Math.ceil(Math.random()*10);return l.slice(0,i).join("")}function v(l){typeof e[l]=="string"&&(e[l]=e[l].replace(/[^0-9]/g,"").replace(/^0+(?=\d)/,""),e[l]=Number(e[l]))}return(l,i)=>{const u=H("el-input"),f=H("el-form-item"),w=H("el-button"),b=H("el-form");return I(),$("div",null,[o(b,{inline:""},{default:c(()=>[o(f,{label:"列表总数"},{default:c(()=>[o(u,{modelValue:e.total,"onUpdate:modelValue":i[0]||(i[0]=n=>e.total=n),modelModifiers:{number:!0},placeholder:"请输入列表总数",maxlength:"6",onBlur:i[1]||(i[1]=n=>v("total"))},null,8,["modelValue"])]),_:1}),o(f,{label:"缓冲量"},{default:c(()=>[o(u,{modelValue:e.buffer,"onUpdate:modelValue":i[2]||(i[2]=n=>e.buffer=n),placeholder:"请输入滚动时的缓冲量",maxlength:"5",onBlur:i[3]||(i[3]=n=>v("buffer"))},null,8,["modelValue"])]),_:1}),o(f,null,{default:c(()=>[o(w,{type:"primary",onClick:h},{default:c(()=>[M("更新列表")]),_:1})]),_:1})]),_:1}),L("div",he,[o(G,{data:d.value,"max-height":pe,buffer:a.value,fixed:!1},{default:c(({items:n})=>[M(U(n.msg),1)]),_:1},8,["data","buffer"])])])}}},_e=k(ge,[["__scopeId","data-v-9e44ceea"]]);const ve=m=>(oe("data-v-42faf1d4"),m=m(),ue(),m),be=ve(()=>L("div",{class:"title"},"虚拟列表",-1)),xe={__name:"index",setup(m){return(e,d)=>{const a=H("el-tab-pane"),h=H("el-tabs");return I(),$(D,null,[be,o(h,{"model-value":"1"},{default:c(()=>[o(a,{label:"定高",name:"1"},{default:c(()=>[o(me)]),_:1}),o(a,{label:"非定高",name:"2",lazy:""},{default:c(()=>[o(_e)]),_:1})]),_:1})],64)}}},we=k(xe,[["__scopeId","data-v-42faf1d4"]]);export{we as default};
