import{_ as P}from"./index-89cf82f9.js";import{_ as Q,r as v,s as V,o as T,c as L,a as E,n as C,F as X,m as Y,x as Z,y as ee,e as te,t as le,h as ae,j as oe,z as S}from"./index-6269380d.js";const ie={class:"virtual-list"},re={__name:"index",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},cache:{type:Number,default:2},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0},showOverflowTooltip:{type:Boolean,default:!1},autoResetScrollBar:{type:Boolean,default:!1}},setup(h,{expose:$}){const a=h;let g=[],c=0;const d=v(null);let n=0,D=0,H=0;const x=v([]);let m=0,r=0,s=0;const b=v(0),w=v(0),p=v(null),y=v(null);let f=[],B=!1;const u=v(null),z=()=>{let e=a.cache+a.buffer*2;return e<2&&(e=2),e};function N(e){const t=e.getBoundingClientRect().height;return Math.round(t*100)/100}const A=()=>{const e=y.value.children,t=[];for(let l=0;l<e.length;l++)t.push(N(e[l]));for(let l=t.length;l<g.length;l++)t.push(a.minItemHeight);return t},O=()=>{if(!p.value)return 0;const e=p.value.scrollTop;if(e===0)return 0;let t=0;if(a.fixed)t=Math.floor(e/n);else{let o=0;for(let i=0;i<f.length;i++){if(o+=f[i],e===o){t=i+1;break}if(e<o){t=i;break}}}t-=Math.floor(H/2);const l=c-m;return t<0?t=0:t>l&&(t=l),t},R=e=>{let t=e+m-1;const l=c-1;return t>l&&(t=l),t},F=()=>{const e=p.value.scrollTop;if(r===0)return e;let t=0;if(a.fixed)t=e-r*n;else{let l=0;for(let o=0;o<r;o++)l+=f[o];t=e-l}return t},W=()=>{const e=p.value.scrollTop;let t=0;if(a.fixed)t=(s+1)*n-e-d.value;else{let l=0;for(let o=0;o<=s;o++)l+=f[o];t=l-e-d.value}return t},j=()=>{const e=F(),t=W();if(a.fixed){const l=a.buffer*n;return e<l||t<l}else{let l=0,o=0;for(let i=r;i<r+a.buffer;i++)l+=f[i];for(let i=s+1-a.buffer;i<=s;i++)o+=f[i];return e<l||t<o}},k=()=>{x.value=g,b.value=0,w.value=0},I=()=>{if(D=Math.ceil(d.value/n),H=z(),m=D+H,m>=c){k();return}r=O(),s=R(r),b.value=r*n,w.value=(c-s-1)*n,x.value=g.slice(r,s+1),a.fixed||S(()=>{f=A()})},q=()=>{if(g=a.data.map((e,t)=>({id:`${Date.now()}-${t}`,data:e})),c=g.length,d.value=a.height||a.maxHeight,c===0||!d.value){k();return}a.fixed?(x.value=g.slice(0,m||1),S(()=>{n=y.value.children[0].clientHeight,I()})):(n=a.minItemHeight,I())},U=()=>{if(!j())return;const e=O();if(e!==r)if(r=e,s=R(r),x.value=g.slice(r,s+1),a.fixed)b.value=r*n,w.value=(c-s-1)*n;else{let t=0;for(let o=0;o<r;o++)t+=f[o];b.value=t;let l=0;for(let o=s+1;o<c;o++)l+=f[o];w.value=l,S(()=>{const o=y.value.children,i=[];for(let _=0;_<o.length;_++)i.push(N(o[_]));f.splice(r,i.length,...i)})}},M=()=>{p.value&&(p.value.scrollTop=0)};V(()=>a.data,()=>{a.autoResetScrollBar&&M(),q()},{immediate:!0,deep:!0}),V([()=>a.height,()=>a.maxHeight],()=>{if(d.value=a.height||a.maxHeight,!d.value){k();return}I()});const G=()=>{a.showOverflowTooltip&&(u.value=null),!B&&(B=!0,requestAnimationFrame(()=>{B=!1}),!(m>=c)&&U())},J=e=>{if(!(!a.showOverflowTooltip||e.target===e.currentTarget||u.value&&(u.value.contains(e.relatedTarget)||!u.value.contains(e.target)))&&(u.value=e.target,e.target.parentElement!==e.currentTarget)){const t=e.currentTarget.children;for(let l=0;l<t.length;l++)if(t[l].contains(e.target)){u.value=t[l];break}}},K=e=>{!a.showOverflowTooltip||u.value&&(!u.value.contains(e.target)||u.value.contains(e.relatedTarget))||(u.value=null)};return $({resetScrollBar:M}),(e,t)=>(T(),L("div",ie,[E("div",{ref_key:"listWrapRef",ref:p,class:"list-wrap",style:C({height:h.height?h.height+"px":"","max-height":d.value?d.value+"px":""}),onScroll:G},[E("ul",{ref_key:"listRef",ref:y,style:C({"padding-top":b.value+"px","padding-bottom":w.value+"px"}),onMouseover:J,onMouseout:K},[(T(!0),L(X,null,Y(x.value,l=>(T(),L("li",{key:l.id,class:Z(["list-item",{tooltip:h.showOverflowTooltip}]),style:C({"white-space":h.fixed?"nowrap":"normal","word-break":h.fixed?"normal":"break-all",overflow:h.fixed?"hidden":"visible"})},[ee(e.$slots,"default",{item:l.data},()=>[te(le(l),1)],!0)],6))),128))],36)],36),h.showOverflowTooltip?(T(),ae(P,{key:0,"mouseenter-el":u.value,enterable:!1,"teleport-to-body":!1},null,8,["mouseenter-el"])):oe("",!0)]))}},ue=Q(re,[["__scopeId","data-v-8e9d2fb9"]]);export{ue as V};
