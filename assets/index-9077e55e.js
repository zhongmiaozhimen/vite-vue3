import{_ as $,a as r,B as N,C as D,D as G,b as k,o as h,c as x,d as n,w as i,q as j,E as O,h as W,i as J,f as A,t as Y,G as w,m as Q,F as z,k as X,e as H,s as Z,H as ee,p as te,g as le}from"./index-4fb89d43.js";const oe={__name:"table",props:{data:{type:Array,default:()=>[]},maxHeight:{type:Number,default:void 0},editRowKey:{type:String,default:""},editCloseBefore:{type:Function,default:void 0},checkResult:{type:Array,default:()=>[]}},emits:["edit-open","edit-close"],setup(a,{expose:p,emit:c}){const o=a,u=r(""),l=r("");let d=null;const f=y=>{d=y};N("edit-cell",{editRowId:u,editProp:l,editRowKey:o.editRowKey}),N("updateEditCellEl",f),N("check-result",o.checkResult);const m=r(null),_=r(!1),v=r(null),V=r("");let C=null;const S=()=>{!u.value||!l.value||(c("edit-close",C,l.value),u.value="",l.value="",d=null)},B=(y,E,q,R)=>{const t=E.property;d!=null&&d.contains(R.target)||(S(),_.value=!1,C=y,u.value=y[o.editRowKey],l.value=t,c("edit-open",y,t))},U=y=>{!u.value||!l.value||d!=null&&d.contains(y.target)||o.editCloseBefore(y)!==!1&&S()},M=(y,E,q)=>{const R=q.querySelector(".tooltip");if(!R)return;const t=document.createRange();t.setStart(R,0),t.setEnd(R,R.childNodes.length);const e=t.getBoundingClientRect().width,s=window.getComputedStyle(R),b=parseInt(s.getPropertyValue("padding-left"))+parseInt(s.getPropertyValue("padding-right")),P=R.getBoundingClientRect().width;e+b-P>.02&&(v.value=R,_.value=!0,V.value=R.innerText)},K=(y,E)=>{C=y,u.value=y[o.editRowKey],l.value=E};return D(()=>{document.addEventListener("mouseup",U)}),G(()=>{document.removeEventListener("mouseup",U)}),p({ref:m,setEditCell:K}),(y,E)=>{const q=k("el-table"),R=k("el-tooltip");return h(),x("div",null,[n(q,{ref_key:"tableRef",ref:m,data:a.data,border:"",stripe:"","max-height":a.maxHeight,onCellClick:B,onCellMouseEnter:M},{default:i(()=>[j(y.$slots,"default",{},void 0,!0)]),_:3},8,["data","max-height"]),n(R,{visible:_.value,"onUpdate:visible":E[0]||(E[0]=t=>_.value=t),"virtual-ref":v.value,"virtual-triggering":"",content:V.value,placement:"top",teleported:!1},null,8,["visible","virtual-ref","content"])])}}},ne=$(oe,[["__scopeId","data-v-f9002023"]]);const ae={__name:"table-edit-cell",setup(a){const p=O("updateEditCellEl"),c=r(null);return D(()=>{p(c.value)}),(o,u)=>(h(),x("div",{ref_key:"editCellRef",ref:c,class:"editor"},[j(o.$slots,"default",{},void 0,!0)],512))}},ue=$(ae,[["__scopeId","data-v-e5ee7b15"]]);const de={key:0,class:"required"},se={class:"label"},ie={__name:"table-column",props:{prop:{type:String,default:""},label:{type:String,default:""},minWidth:{type:Number,default:void 0},required:{type:Boolean,default:!1}},setup(a){const{editRowId:p,editProp:c,editRowKey:o}=O("edit-cell"),u=O("check-result");function l(d,f){const m=u.find(_=>_[o]===d);if(m)return m[f]}return(d,f)=>{const m=k("EditPen"),_=k("el-icon"),v=k("el-table-column");return h(),W(v,{prop:a.prop,"min-width":a.minWidth,"class-name":"editor-column"},{header:i(()=>[a.required?(h(),x("i",de,"*")):J("",!0),A("span",se,Y(a.label),1),n(_,null,{default:i(()=>[n(m)]),_:1})]),default:i(({row:V})=>[w(p)===V[w(o)]&&w(c)===a.prop?(h(),W(ue,{key:0},{default:i(()=>[j(d.$slots,"default",{},void 0,!0)]),_:3})):(h(),x("div",{key:1,class:Q(["no-editor","tooltip",l(V[w(o)],a.prop)])},Y(V[a.prop]),3))]),_:3},8,["prop","min-width"])}}},I=$(ie,[["__scopeId","data-v-babafa16"]]);const re={__name:"cell-input",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(a,{emit:p}){const c=a,o=r(null);function u(){o.value.focus()}function l(){const d=c.modelValue.trim();p("update:model-value",d)}return D(()=>{c.autofocus&&u()}),(d,f)=>{const m=k("el-input");return h(),x("div",null,[n(m,{ref_key:"inputRef",ref:o,"model-value":a.modelValue,placeholder:"请输入","onUpdate:modelValue":f[0]||(f[0]=_=>d.$emit("update:model-value",_)),onBlur:l},null,8,["model-value"])])}}},L=$(re,[["__scopeId","data-v-59b0804f"]]);const ce={__name:"cell-date",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(a,{expose:p}){const c=a,o=r(null),u=r(null),l=`date-prper-${Date.now()}`;function d(){o.value.focus()}return D(()=>{c.autofocus&&d(),u.value=document.querySelector(`.${l}`)}),p({popoverEl:u}),(f,m)=>{const _=k("el-date-picker");return h(),x("div",null,[n(_,{ref_key:"dateRef",ref:o,"model-value":a.modelValue,type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期","popper-class":l,"onUpdate:modelValue":m[0]||(m[0]=v=>f.$emit("update:model-value",v))},null,8,["model-value"])])}}},pe=$(ce,[["__scopeId","data-v-94d62495"]]);const fe={__name:"cell-select",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(a,{expose:p}){const c=a,o=r(null),u=r(null);function l(){o.value.toggleMenu()}return D(()=>{c.autofocus&&l(),u.value=o.value.popperPaneRef}),p({popoverEl:u}),(d,f)=>{const m=k("el-option"),_=k("el-select");return h(),x("div",null,[n(_,{ref_key:"selectRef",ref:o,"model-value":a.modelValue,placeholder:"请选择",clearable:"",filterable:"","onUpdate:modelValue":f[0]||(f[0]=v=>d.$emit("update:model-value",v))},{default:i(()=>[(h(!0),x(z,null,X(a.options,v=>(h(),W(m,{key:v,label:v,value:v},null,8,["label","value"]))),128))]),_:1},8,["model-value"])])}}},F=$(fe,[["__scopeId","data-v-5b8163f3"]]);const _e={__name:"textarea-popover",props:{modelValue:{type:String,default:""},autofocus:{type:Boolean,default:!0}},emits:["update:model-value"],setup(a,{expose:p,emit:c}){const o=a,u=r(null),l=r(null),d=r(null),f=r(null),m=o.modelValue;function _(){d.value.focus()}function v(){const V=o.modelValue.trim();c("update:model-value",V)}return D(()=>{o.autofocus&&_(),f.value=l.value.popperRef.contentRef}),p({popoverEl:f}),(V,C)=>{const S=k("el-input"),B=k("el-popover");return h(),x(z,null,[A("div",{ref_key:"virtualRef",ref:u,class:"trigger"},Y(w(m)),513),n(B,{ref_key:"popoverRef",ref:l,visible:"","virtual-ref":u.value,trigger:"click","virtual-triggering":"",placement:"bottom-start",width:200},{default:i(()=>[n(S,{ref_key:"inputRef",ref:d,"model-value":a.modelValue,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入","onUpdate:modelValue":C[0]||(C[0]=U=>V.$emit("update:model-value",U)),onBlur:v},null,8,["model-value"])]),_:1},8,["virtual-ref"])],64)}}},me=$(_e,[["__scopeId","data-v-8171fbe7"]]),T="id",ve={__name:"index",setup(a){const p=r(null);let c=400;const o=r([{id:"1",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"2",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"3",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""},{id:"4",date:"2016-05-03",name:"张三",province:"黑龙江",city:"哈尔滨",address:"南岗区-哈尔滨大街501号",zip:"000000",remark:""}]),u=r(null),l=r(""),d=r(!0),f=r([]),m=[],_=["date","name","province","city","address"],v=[{province:"黑龙江",citys:["哈尔滨","齐齐哈尔","鸡西","鹤岗"]},{province:"吉林",citys:["长春","通化","白山","四平"]},{province:"辽宁",citys:["辽阳","大连","鞍山","抚顺"]}];let V=[],C=[];const S=t=>{let e={id:t};m.forEach(s=>{e[s]=""}),f.value.push(e)},B=(t,e,s)=>{const b=f.value.find(P=>P[T]===t);b&&(b[e]=s)};o.value.forEach(t=>{S(t[T])});const U=t=>{if(!t.province){t.city="";return}const e=t.city,{citys:s}=v.find(b=>b.province===t.province);s.includes(e)||(t.city="")},M=(t,e)=>{if(l.value=t[e],d.value=!0,e==="province")V=v.map(s=>s.province);else if(e==="city")if(t.province){const{citys:s}=v.find(b=>b.province===t.province);C=s}else C=[]},K=t=>{var e;if((e=u.value.popoverEl)!=null&&e.contains(t.target))return!1},y=(t,e)=>{_.includes(e)&&(l.value?t[e]!==l.value&&B(t[T],e,"success"):B(t[T],e,"error")),t[e]=l.value,e==="province"&&U(t)};function E(){const t=`${Date.now()}-${o.value.length+1}`;o.value.push({id:t,date:"",name:"",province:"",city:"",address:"",zip:"",remark:""}),d.value=!1,S(t),Z(()=>{p.value.ref.setScrollTop(c),p.value.ref.setScrollLeft(0);const e=o.value[o.value.length-1];p.value.setEditCell(e,"date")})}const q=t=>{const e=o.value.findIndex(s=>s.id===t);e>=0&&o.value.splice(e,1)};function R(t){let e=!1;if(o.value.forEach(s=>{for(const b in s)_.includes(b)&&!s[b]&&(e=!0,B(s[T],b,"error"))}),e){ee.alert("必填项未填写","",{confirmButtonText:"确认",type:"error",callback:()=>{}});return}new Promise(s=>{setTimeout(()=>{s()},500)}).then(()=>{t&&t()})}return(t,e)=>{const s=k("el-button"),b=k("el-row"),P=k("el-table-column");return h(),x(z,null,[n(b,{justify:"end"},{default:i(()=>[n(s,{type:"primary",plain:"",onClick:E},{default:i(()=>[H("新增")]),_:1})]),_:1}),n(ne,{ref_key:"tableRef",ref:p,data:o.value,"check-result":f.value,"max-height":w(c),"edit-row-key":T,"edit-close-before":K,onEditOpen:M,onEditClose:y},{default:i(()=>[n(P,{type:"index",fixed:"",label:"序号",width:"70"}),n(I,{prop:"date",label:"日期","min-width":140,required:""},{default:i(()=>[n(pe,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=g=>l.value=g),autofocus:d.value},null,8,["modelValue","autofocus"])]),_:1}),n(I,{prop:"name",label:"名字","min-width":120,required:""},{default:i(()=>[n(L,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=g=>l.value=g)},null,8,["modelValue"])]),_:1}),n(I,{prop:"province",label:"省份","min-width":120,required:""},{default:i(()=>[n(F,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=g=>l.value=g),options:w(V)},null,8,["modelValue","options"])]),_:1}),n(I,{prop:"city",label:"城市","min-width":120,required:""},{default:i(()=>[n(F,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[3]||(e[3]=g=>l.value=g),options:w(C)},null,8,["modelValue","options"])]),_:1}),n(I,{prop:"address",label:"地址","min-width":170,required:""},{default:i(()=>[n(L,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[4]||(e[4]=g=>l.value=g)},null,8,["modelValue"])]),_:1}),n(I,{prop:"zip",label:"邮编","min-width":120},{default:i(()=>[n(L,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[5]||(e[5]=g=>l.value=g)},null,8,["modelValue"])]),_:1}),n(I,{prop:"remark",label:"备注","min-width":180},{default:i(()=>[n(me,{ref_key:"editorRef",ref:u,modelValue:l.value,"onUpdate:modelValue":e[6]||(e[6]=g=>l.value=g)},null,8,["modelValue"])]),_:1}),n(P,{label:"操作","min-width":"70",fixed:"right"},{default:i(({row:g})=>[n(b,null,{default:i(()=>[n(s,{link:"",type:"primary",onClick:ke=>q(g.id)},{default:i(()=>[H("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","check-result","max-height"]),n(b,{justify:"center",class:"mg-top-20"},{default:i(()=>[n(s,{type:"primary",onClick:e[7]||(e[7]=g=>R())},{default:i(()=>[H("保存")]),_:1})]),_:1})],64)}}};const ye=a=>(te("data-v-aa0cdc05"),a=a(),le(),a),be=ye(()=>A("div",{class:"title"},"表格编辑",-1)),ge={__name:"index",setup(a){return(p,c)=>{const o=k("el-tab-pane"),u=k("el-tabs");return h(),x(z,null,[be,n(u,{"model-value":"1"},{default:i(()=>[n(o,{label:"单元格编辑",name:"1"},{default:i(()=>[n(ve)]),_:1})]),_:1})],64)}}},he=$(ge,[["__scopeId","data-v-aa0cdc05"]]);export{he as default};
