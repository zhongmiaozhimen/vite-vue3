import{_ as Q}from"./index-32f48d43.js";import{_ as U,r as p,s as z,o as H,c as E,a as F,n as N,F as X,m as Y,y as Z,z as ee,e as te,t as le,h as oe,j as ie,A as O}from"./index-6dc4e29e.js";const ae={class:"virtual-list"},ne={__name:"index",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},cache:{type:Number,default:2},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0},showOverflowTooltip:{type:Boolean,default:!1},autoResetScrollBar:{type:Boolean,default:!1}},setup(f,{expose:D}){const o=f;let c=[],s=0;const h=p(null);let u=0,I=0,B=0;const m=p([]);let g=0,n=0,d=0;const x=p(0),w=p(0),T=p(null),y=p(null);let v=[],k=!1;const a=p(null);function W(){let e=o.cache+o.buffer*2;return e<2&&(e=2),e}function j(){const e=y.value.children,t=[];for(let l=0;l<e.length;l++)t.push(e[l].getBoundingClientRect().height);for(let l=t.length;l<c.length;l++)t.push(u);return t}function R(){if(!T.value)return 0;const e=T.value.scrollTop;if(e===0)return 0;let t=0;if(o.fixed)t=Math.floor(e/u);else{let l=0;for(let i=0;i<v.length;i++){if(l+=v[i],e===l){t=i+1;break}if(e<l){t=i;break}}}return t}function V(e){let t=e-Math.floor(B/2);const l=s-g;t<0?t=0:t>l&&(t=l);let i=t+g-1;const b=s-1;return i>b&&(i=b),{listStartIndex:t,listEndIndex:i}}function C(){m.value=c,x.value=0,w.value=0}function q(){if(c=o.data.map((e,t)=>({id:`${Date.now()}-${t}`,data:e})),s=c.length,h.value=o.height||o.maxHeight,s===0||!h.value){C();return}o.fixed?(m.value=c.slice(0,g||1),O(()=>{u=y.value.children[0].clientHeight,_()})):(u=o.minItemHeight,_())}function _(){if(I=Math.ceil(h.value/u),B=W(),g=I+B,g>=s){C();return}const e=R(),{listStartIndex:t,listEndIndex:l}=V(e);n=t,d=l,x.value=n*u,w.value=(s-d-1)*u,m.value=c.slice(n,d+1),o.fixed||O(()=>{v=j()})}function G(){let e=R();const t=e-n;if(d+1-e-I>o.buffer&&t>o.buffer)return;const{listStartIndex:i,listEndIndex:b}=V(e);if(i!==n)if(n=i,d=b,m.value=c.slice(n,d+1),o.fixed)x.value=n*u,w.value=(s-d-1)*u;else{let A=0;for(let r=0;r<n;r++)A+=v[r];x.value=A;let $=0;for(let r=d+1;r<s;r++)$+=v[r];w.value=$,O(()=>{const r=y.value.children,L=[];for(let S=0;S<r.length;S++)L.push(r[S].getBoundingClientRect().height);v.splice(n,L.length,...L)})}}function M(){T.value&&(T.value.scrollTop=0)}z(()=>o.data,()=>{o.autoResetScrollBar&&M(),q()},{immediate:!0,deep:!0}),z([()=>o.height,()=>o.maxHeight],()=>{if(h.value=o.height||o.maxHeight,!h.value){C();return}_()});function J(){o.showOverflowTooltip&&(a.value=null),!k&&(k=!0,requestAnimationFrame(()=>{k=!1}),!(g>=s)&&G())}function K(e){if(!(!o.showOverflowTooltip||e.target===e.currentTarget||a.value&&(a.value.contains(e.fromElement)||!a.value.contains(e.target)))&&(a.value=e.target,e.target.parentElement!==e.currentTarget)){const t=e.currentTarget.children;for(let l=0;l<t.length;l++)if(t[l].contains(e.target)){a.value=t[l];break}}}function P(e){!o.showOverflowTooltip||a.value&&(!a.value.contains(e.target)||a.value.contains(e.toElement))||(a.value=null)}return D({resetScrollBar:M}),(e,t)=>(H(),E("div",ae,[F("div",{ref_key:"listWrapRef",ref:T,class:"list-wrap",style:N({height:f.height?f.height+"px":"","max-height":h.value?h.value+"px":""}),onScroll:J},[F("ul",{ref_key:"listRef",ref:y,style:N({"padding-top":x.value+"px","padding-bottom":w.value+"px"}),onMouseover:K,onMouseout:P},[(H(!0),E(X,null,Y(m.value,l=>(H(),E("li",{key:l.id,class:Z(["list-item",{tooltip:f.showOverflowTooltip}]),style:N({"white-space":f.fixed?"nowrap":"normal","word-break":f.fixed?"normal":"break-all",overflow:f.fixed?"hidden":"visible"})},[ee(e.$slots,"default",{item:l.data},()=>[te(le(l),1)],!0)],6))),128))],36)],36),f.showOverflowTooltip?(H(),oe(Q,{key:0,"mouseenter-el":a.value,enterable:!1,"teleport-to-body":!1},null,8,["mouseenter-el"])):ie("",!0)]))}},ue=U(ne,[["__scopeId","data-v-22fc9152"]]);export{ue as V};
