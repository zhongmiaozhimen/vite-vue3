import{_ as k,r as p,n as W,w as T,o as $,c as L,a as M,F as j,b as X,d as S,e as Y,f as z,g as H,h as a,i as d,j as E,t as q,p as Z,k as ee}from"./index-a58f8291.js";const te={__name:"virtual-list",props:{data:{type:Array,default:()=>[]},height:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},itemHeight:{type:Number,default:void 0},minItemHeight:{type:Number,default:20},buffer:{type:Number,default:1},fixed:{type:Boolean,default:!0}},setup(h){const e=h;let r=A(),u=r.length;const _=p(e.height?null:e.maxHeight);let g=e.itemHeight,V=0,m=0;const l=p([]);let t=0,o=0;const s=p(0),v=p(0);let b=0;const n=p(null),w=p(null);let B=[],R=!1;K();function A(){return e.data.map((i,f)=>({id:`${new Date().getTime()}-${f}`,data:i}))}function C(){l.value=r,s.value=0,v.value=0,b=0}function G(){if(!e.height&&!e.maxHeight)return;let i=0;return e.fixed?e.height?i=Math.ceil(e.height/g):i=Math.ceil(e.maxHeight/g):e.height?i=Math.ceil(e.height/e.minItemHeight):i=Math.ceil(e.maxHeight/e.minItemHeight),i}function J(){const i=w.value.children,f=[];for(let c=0;c<i.length;c++)f.push(i[c].getBoundingClientRect().height);for(let c=f.length;c<r.length;c++)f.push(e.minItemHeight);return f}function K(){if(u<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){C();return}if(e.fixed&&!e.itemHeight){l.value=r.slice(0,1),W(()=>{g=w.value.children[0].clientHeight,N()});return}N()}function N(){if(V=G(),m=e.buffer*2||1,V+m>=u){C();return}const i=V+m;t=0,o=i-1,s.value=0,e.fixed?v.value=(u-i)*g:v.value=(u-i)*e.minItemHeight,l.value=r.slice(t,o+1),b=0,e.fixed||W(()=>{B=J()})}function P(i){let f=0;if(e.fixed)f=Math.floor(i/g);else{let I=0;for(let y=0;y<B.length;y++){if(I+=B[y],i===I){f=y+1;break}if(i<I){f=y;break}}}if(i>b){if(b=i,o+1-f-V>e.buffer)return}else if(i<b){if(b=i,f-t>e.buffer)return}else return;m%2?t=f-Math.floor(m/2):t=f-m/2;const c=u-l.value.length;t<0?t=0:t>c&&(t=c),o=t+l.value.length-1;const D=u-1;if(o>D&&(o=D),l.value=r.slice(t,o+1),e.fixed)s.value=t*g,v.value=(u-o-1)*g;else{let I=0;for(let x=0;x<t;x++)I+=B[x];s.value=I;let y=0;for(let x=o+1;x<u;x++)y+=B[x];v.value=y,W(()=>{const x=w.value.children,U=[];for(let F=0;F<x.length;F++)U.push(x[F].getBoundingClientRect().height);B.splice(t,U.length,...U)})}}T(()=>e.data,()=>{if(n.value&&(n.value.scrollTop=0),r=A(),u=r.length,u<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){C();return}N()}),T([()=>e.height,()=>e.maxHeight],()=>{if(u<=2||!e.height&&!e.maxHeight||!e.fixed&&!e.minItemHeight){C();return}_.value=e.height?null:e.maxHeight,N()});function Q(i){u<=2||!e.height&&!e.maxHeight||l.value.length>=u||!e.fixed&&!e.minItemHeight||R||(R=!0,requestAnimationFrame(()=>{R=!1}),P(i.target.scrollTop))}return(i,f)=>($(),L("div",{ref_key:"listWrapRef",ref:n,class:"list-wrap",style:S({height:h.height?h.height+"px":"","max-height":_.value?_.value+"px":""}),onScroll:Q},[M("ul",{ref_key:"listRef",ref:w,style:S({"padding-top":s.value+"px","padding-bottom":v.value+"px"})},[($(!0),L(j,null,X(l.value,c=>($(),L("li",{key:c.id,class:"list-item",style:S({height:h.fixed&&e.itemHeight?e.itemHeight+"px":"","word-break":h.fixed?"normal":"break-all",overflow:h.fixed?"hidden":"visible"})},[Y(i.$slots,"default",{item:c.data},void 0,!0)],4))),128))],4)],36))}},O=k(te,[["__scopeId","data-v-7e9ba468"]]);const le={class:"wrap"},ie=500,ne={__name:"fixed-virtual-list",setup(h){const e=z({total:1e3,itemHeight:"",buffer:0}),r=p([]),u=p(0),_=p(0);g();function g(){r.value=[];for(let l=1;l<=e.total;l++)r.value.push({msg:`${V()} --- ${l}`});u.value=e.itemHeight,_.value=e.buffer}function V(){let l="";const t=["a","b","c","d","e","f","g","h","i","j","k"];for(let o=0;o<t.length;o++){const s=Math.ceil(Math.random()*10);l+=t[s]}return l}function m(l){e[l]!==""&&typeof e[l]=="string"&&(e[l]=e[l].replace(/[^0-9]/g,"").replace(/^0+(?=\d)/,""),e[l]=Number(e[l]))}return(l,t)=>{const o=H("el-input"),s=H("el-form-item"),v=H("el-button"),b=H("el-form");return $(),L("div",null,[a(b,{inline:""},{default:d(()=>[a(s,{label:"列表总数"},{default:d(()=>[a(o,{modelValue:e.total,"onUpdate:modelValue":t[0]||(t[0]=n=>e.total=n),modelModifiers:{number:!0},placeholder:"请输入列表总数",maxlength:"6",onBlur:t[1]||(t[1]=n=>m("total"))},null,8,["modelValue"])]),_:1}),a(s,{label:"行高"},{default:d(()=>[a(o,{modelValue:e.itemHeight,"onUpdate:modelValue":t[2]||(t[2]=n=>e.itemHeight=n),modelModifiers:{number:!0},placeholder:"请输入每一行的高度",maxlength:"3",onBlur:t[3]||(t[3]=n=>m("itemHeight"))},null,8,["modelValue"])]),_:1}),a(s,{label:"缓冲量"},{default:d(()=>[a(o,{modelValue:e.buffer,"onUpdate:modelValue":t[4]||(t[4]=n=>e.buffer=n),modelModifiers:{number:!0},placeholder:"请输入滚动时的缓冲量",maxlength:"5",onBlur:t[5]||(t[5]=n=>m("buffer"))},null,8,["modelValue"])]),_:1}),a(s,null,{default:d(()=>[a(v,{type:"primary",onClick:g},{default:d(()=>[E("更新列表")]),_:1})]),_:1})]),_:1}),M("div",le,[a(O,{data:r.value,"max-height":ie,"item-height":u.value,buffer:_.value},{default:d(({item:n})=>[M("div",{class:"list-item",style:S({"line-height":u.value?u.value-1+"px":""})},q(n.msg),5)]),_:1},8,["data","item-height","buffer"])])])}}},ae=k(ne,[["__scopeId","data-v-6aa76dd9"]]);const ue={class:"wrap"},oe={class:"list-item"},re=500,se={__name:"dynamic-virtual-list",setup(h){const e=z({total:1e3,minItemHeight:45,buffer:0}),r=p([]),u=p(0),_=p(0);g();function g(){r.value=[];for(let l=1;l<=e.total;l++)r.value.push({msg:`${V()} --- ${l}`});u.value=e.minItemHeight,_.value=e.buffer}function V(){const l=["道可道也，非恒道也。","名可名也，非恒名也。","无名万物之始也，有名万物之母也。","故：恒无欲也，以观其眇；","恒有欲也，以观其徼。","两者同出，异名同谓。玄之又玄，众妙之门。","天下皆知美之为美，恶矣，皆知善之为善，斯不善矣。","有无之相生也，难易之相成也，长短之相形也，高下之相盈也，音声之相和也，先后之相随也。","是以圣人居无为之事，行不言之教。","万物作而弗始也，为而弗恃也，成功而弗居也，夫唯弗居，是以弗去。"],t=Math.ceil(Math.random()*10);return l.slice(0,t)}function m(l){typeof e[l]=="string"&&(e[l]=e[l].replace(/[^0-9]/g,"").replace(/^0+(?=\d)/,""),e[l]=Number(e[l]))}return(l,t)=>{const o=H("el-input"),s=H("el-form-item"),v=H("el-button"),b=H("el-form");return $(),L("div",null,[a(b,{inline:""},{default:d(()=>[a(s,{label:"列表总数"},{default:d(()=>[a(o,{modelValue:e.total,"onUpdate:modelValue":t[0]||(t[0]=n=>e.total=n),modelModifiers:{number:!0},placeholder:"请输入列表总数",maxlength:"6",onBlur:t[1]||(t[1]=n=>m("total"))},null,8,["modelValue"])]),_:1}),a(s,{label:"最小行高"},{default:d(()=>[a(o,{modelValue:e.minItemHeight,"onUpdate:modelValue":t[2]||(t[2]=n=>e.minItemHeight=n),placeholder:"请输入行高的最小值",maxlength:"3",onBlur:t[3]||(t[3]=n=>m("minItemHeight"))},null,8,["modelValue"])]),_:1}),a(s,{label:"缓冲量"},{default:d(()=>[a(o,{modelValue:e.buffer,"onUpdate:modelValue":t[4]||(t[4]=n=>e.buffer=n),placeholder:"请输入滚动时的缓冲量",maxlength:"5",onBlur:t[5]||(t[5]=n=>m("buffer"))},null,8,["modelValue"])]),_:1}),a(s,null,{default:d(()=>[a(v,{type:"primary",onClick:g},{default:d(()=>[E("更新列表")]),_:1})]),_:1})]),_:1}),M("div",ue,[a(O,{data:r.value,"max-height":re,"min-item-height":u.value,buffer:_.value,fixed:!1},{default:d(({item:n})=>[M("div",oe,q(n.msg),1)]),_:1},8,["data","min-item-height","buffer"])])])}}},de=k(se,[["__scopeId","data-v-69113200"]]);const fe=h=>(Z("data-v-111c59da"),h=h(),ee(),h),me=fe(()=>M("div",{class:"title"},"虚拟列表",-1)),he={__name:"index",setup(h){return(e,r)=>{const u=H("el-tab-pane"),_=H("el-tabs");return $(),L(j,null,[me,a(_,{modelValue:"1"},{default:d(()=>[a(u,{label:"定高",name:"1"},{default:d(()=>[a(ae)]),_:1}),a(u,{label:"非定高",name:"2",lazy:""},{default:d(()=>[a(de)]),_:1})]),_:1})],64)}}},ce=k(he,[["__scopeId","data-v-111c59da"]]);export{ce as default};
